module.exports={929549:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:r,__dirname:t,m:i,e:s}=e;i.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:r,__dirname:t}=e;e.s({DELIVERY_STATUS:()=>s.DELIVERY_STATUS,DELIVERY_TYPES:()=>s.DELIVERY_TYPES,DOMAIN_STATUS:()=>s.DOMAIN_STATUS,EMAIL_STATUS:()=>s.EMAIL_STATUS,ENDPOINT_TYPES:()=>s.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>s.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>s.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>s.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>s.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>s.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>s.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>s.blockedEmails,domainDnsRecords:()=>s.domainDnsRecords,emailAddresses:()=>s.emailAddresses,emailDomains:()=>s.emailDomains,emailGroups:()=>s.emailGroups,endpointDeliveries:()=>s.endpointDeliveries,endpoints:()=>s.endpoints,parsedEmails:()=>s.parsedEmails,receivedEmails:()=>s.receivedEmails,sentEmails:()=>s.sentEmails,sesEvents:()=>s.sesEvents,session:()=>i.session,structuredEmails:()=>s.structuredEmails,subscriptions:()=>s.subscriptions,user:()=>i.user,userAccounts:()=>s.userAccounts,userOnboarding:()=>s.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>s.vipAllowedSenders,vipConfigs:()=>s.vipConfigs,vipEmailAttempts:()=>s.vipEmailAttempts,vipPaymentSessions:()=>s.vipPaymentSessions,webhookDeliveries:()=>s.webhookDeliveries,webhooks:()=>s.webhooks});var i=e.i(594120),s=e.i(55379)},436754:e=>{"use strict";var{g:r,__dirname:t}=e;e.s({DELIVERY_STATUS:()=>i.DELIVERY_STATUS,DELIVERY_TYPES:()=>i.DELIVERY_TYPES,DOMAIN_STATUS:()=>i.DOMAIN_STATUS,EMAIL_STATUS:()=>i.EMAIL_STATUS,ENDPOINT_TYPES:()=>i.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>i.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>i.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>i.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>i.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>i.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>i.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>i.blockedEmails,domainDnsRecords:()=>i.domainDnsRecords,emailAddresses:()=>i.emailAddresses,emailDomains:()=>i.emailDomains,emailGroups:()=>i.emailGroups,endpointDeliveries:()=>i.endpointDeliveries,endpoints:()=>i.endpoints,parsedEmails:()=>i.parsedEmails,receivedEmails:()=>i.receivedEmails,sentEmails:()=>i.sentEmails,sesEvents:()=>i.sesEvents,session:()=>i.session,structuredEmails:()=>i.structuredEmails,subscriptions:()=>i.subscriptions,user:()=>i.user,userAccounts:()=>i.userAccounts,userOnboarding:()=>i.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>i.vipAllowedSenders,vipConfigs:()=>i.vipConfigs,vipEmailAttempts:()=>i.vipEmailAttempts,vipPaymentSessions:()=>i.vipPaymentSessions,webhookDeliveries:()=>i.webhookDeliveries,webhooks:()=>i.webhooks}),e.i(468686);var i=e.i(909834)},496669:e=>{"use strict";var{g:r,__dirname:t}=e;e.s({createApiKeyMiddleware:()=>n,validateApiKey:()=>s});var i=e.i(402168);async function s(e){try{let r,t=e.headers.get("Authorization");if(!t)return{valid:!1,error:"Missing Authorization header"};if(r=t.startsWith("Bearer ")?t.substring(7):t,console.log("API KEY: "+r),!r)return{valid:!1,error:"Invalid Authorization header format"};let{valid:s,error:n,key:o}=await i.auth.api.verifyApiKey({body:{key:r}});if(console.log("VALID: "+s),console.log("ERROR: "+n),console.log("KEY: "+o?.userId),!s||n||!o)return{valid:!1,error:n?.message||"Invalid API key"};if(!o.enabled)return{valid:!1,error:"API key is disabled"};if(o.expiresAt&&new Date(o.expiresAt)<new Date)return{valid:!1,error:"API key has expired"};return{valid:!0,user:{id:o.userId,email:o.userId,name:null}}}catch(e){return console.error("API key validation error:",e),{valid:!1,error:"Internal server error during API key validation"}}}function n(){return async e=>{let r=await s(e);return r.valid?{user:r.user}:{error:r.error,status:401}}}},394713:function(e){var{g:r,__dirname:t,m:i,e:s}=e},704385:e=>{"use strict";var{g:r,__dirname:t}=e;e.s({GET:()=>p,POST:()=>c});var i=e.i(125427),s=e.i(496669),n=e.i(557440);e.i(468686);var o=e.i(55379),a=e.i(176825),l=e.i(460009),d=e.i(91890),u=e.i(318812);async function p(e){try{console.log("üìã GET /api/v1.1/endpoints - Fetching user endpoints");let r=await (0,s.validateApiKey)(e);if("error"in r)return i.NextResponse.json({error:r.error},{status:401});let t=r.user?.id;if(!t)return i.NextResponse.json({error:"User not found"},{status:401});let{searchParams:u}=new URL(e.url),p=u.get("type"),c=u.get("active"),m=Math.min(parseInt(u.get("limit")||"50"),100),v=parseInt(u.get("offset")||"0"),f=[(0,a.eq)(o.endpoints.userId,t)];p&&["webhook","email","email_group"].includes(p)&&f.push((0,a.eq)(o.endpoints.type,p)),null!==c&&f.push((0,a.eq)(o.endpoints.isActive,"true"===c));let g=f.length>1?(0,a.and)(...f):f[0],A=n.db.select({id:o.endpoints.id,name:o.endpoints.name,type:o.endpoints.type,config:o.endpoints.config,isActive:o.endpoints.isActive,description:o.endpoints.description,userId:o.endpoints.userId,createdAt:o.endpoints.createdAt,updatedAt:o.endpoints.updatedAt}).from(o.endpoints).where(g),E=await A.orderBy((0,l.desc)(o.endpoints.createdAt)).limit(m).offset(v),S=await n.db.select({count:(0,d.count)()}).from(o.endpoints).where(g),T=S[0]?.count||0,y=await Promise.all(E.map(async e=>{let r={...e,config:JSON.parse(e.config),groupEmails:null,deliveryStats:{total:0,successful:0,failed:0,lastDelivery:null}};"email_group"===e.type&&(r.groupEmails=(await n.db.select({emailAddress:o.emailGroups.emailAddress}).from(o.emailGroups).where((0,a.eq)(o.emailGroups.endpointId,e.id)).orderBy(o.emailGroups.createdAt)).map(e=>e.emailAddress));let t=await n.db.select({total:(0,d.count)(),status:o.endpointDeliveries.status}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,e.id)).groupBy(o.endpointDeliveries.status),i=0,s=0,u=0;for(let e of t)i+=e.total,"success"===e.status&&(s+=e.total),"failed"===e.status&&(u+=e.total);let p=await n.db.select({lastDelivery:o.endpointDeliveries.lastAttemptAt}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,e.id)).orderBy((0,l.desc)(o.endpointDeliveries.lastAttemptAt)).limit(1),c=p[0]?.lastDelivery?.toISOString()||null;return r.deliveryStats={total:i,successful:s,failed:u,lastDelivery:c},r}));return console.log(`‚úÖ GET /api/v1.1/endpoints - Retrieved ${E.length} endpoints for user ${t}`),i.NextResponse.json({success:!0,data:y,pagination:{limit:m,offset:v,total:T,hasMore:v+m<T},meta:{totalCount:T,activeCount:y.filter(e=>e.isActive).length,typeBreakdown:{webhook:y.filter(e=>"webhook"===e.type).length,email:y.filter(e=>"email"===e.type).length,email_group:y.filter(e=>"email_group"===e.type).length}}})}catch(e){return console.error("‚ùå GET /api/v1.1/endpoints - Error:",e),i.NextResponse.json({success:!1,error:"Failed to fetch endpoints",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(e){try{console.log("üìù POST /api/v1.1/endpoints - Creating new endpoint");let r=await (0,s.validateApiKey)(e);if("error"in r)return i.NextResponse.json({error:r.error},{status:401});let t=r.user?.id;if(!t)return i.NextResponse.json({error:"User not found"},{status:401});let a=await e.json();if(!a.name||!a.type||!a.config)return i.NextResponse.json({success:!1,error:"Missing required fields",required:["name","type","config"]},{status:400});if(!["webhook","email","email_group"].includes(a.type))return i.NextResponse.json({success:!1,error:"Invalid endpoint type",validTypes:["webhook","email","email_group"]},{status:400});let l=function(e,r){try{switch(e){case"webhook":if(!r.url)return{valid:!1,error:"Webhook URL is required"};if("string"!=typeof r.url)return{valid:!1,error:"Webhook URL must be a string"};try{new URL(r.url)}catch{return{valid:!1,error:"Invalid webhook URL format"}}if(r.timeout&&("number"!=typeof r.timeout||r.timeout<1||r.timeout>300))return{valid:!1,error:"Timeout must be a number between 1 and 300 seconds"};if(r.retryAttempts&&("number"!=typeof r.retryAttempts||r.retryAttempts<0||r.retryAttempts>10))return{valid:!1,error:"Retry attempts must be a number between 0 and 10"};break;case"email":if(!r.forwardTo)return{valid:!1,error:"Forward-to email address is required"};if("string"!=typeof r.forwardTo)return{valid:!1,error:"Forward-to email must be a string"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.forwardTo))return{valid:!1,error:"Invalid forward-to email address format"};break;case"email_group":if(!r.emails||!Array.isArray(r.emails))return{valid:!1,error:"Email group must have an emails array"};if(0===r.emails.length)return{valid:!1,error:"Email group must have at least one email address"};if(r.emails.length>50)return{valid:!1,error:"Email group cannot have more than 50 email addresses"};let t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let e of r.emails)if("string"!=typeof e||!t.test(e))return{valid:!1,error:`Invalid email address in group: ${e}`};if(new Set(r.emails).size!==r.emails.length)return{valid:!1,error:"Email group contains duplicate email addresses"};break;default:return{valid:!1,error:"Unknown endpoint type"}}return{valid:!0}}catch(e){return{valid:!1,error:"Configuration validation failed"}}}(a.type,a.config);if(!l.valid)return i.NextResponse.json({success:!1,error:"Invalid configuration",details:l.error,configRequirements:function(e){switch(e){case"webhook":return{required:["url"],optional:["secret","headers","timeout","retryAttempts"],description:"Webhook endpoint that receives HTTP POST requests with email data"};case"email":return{required:["forwardTo"],optional:["includeAttachments","subjectPrefix","fromAddress"],description:"Forward emails to a single email address"};case"email_group":return{required:["emails"],optional:["includeAttachments","subjectPrefix","fromAddress"],description:"Forward emails to multiple email addresses (max 50)"};default:return{required:[],optional:[],description:"Unknown endpoint type"}}}(a.type)},{status:400});console.log(`üìù POST /api/v1.1/endpoints - Creating ${a.type} endpoint: ${a.name}`);let d={id:(0,u.nanoid)(),name:a.name,type:a.type,config:JSON.stringify(a.config),description:a.description||null,userId:t,isActive:!0,createdAt:new Date,updatedAt:new Date},[p]=await n.db.insert(o.endpoints).values(d).returning();if("email_group"===a.type&&"emails"in a.config){let e=a.config.emails.map(e=>({id:(0,u.nanoid)(),endpointId:p.id,emailAddress:e,createdAt:new Date}));e.length>0&&(await n.db.insert(o.emailGroups).values(e),console.log(`üìÆ POST /api/v1.1/endpoints - Created ${e.length} email group entries`))}let c={...p,config:JSON.parse(p.config),groupEmails:"email_group"===a.type&&"emails"in a.config?a.config.emails:null,deliveryStats:{total:0,successful:0,failed:0,lastDelivery:null}};return console.log(`‚úÖ POST /api/v1.1/endpoints - Successfully created endpoint ${p.id}`),i.NextResponse.json({success:!0,data:c,message:`${a.type} endpoint created successfully`},{status:201})}catch(e){return console.error("‚ùå POST /api/v1.1/endpoints - Error:",e),i.NextResponse.json({success:!1,error:"Failed to create endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}},406421:e=>{"use strict";var{g:r,__dirname:t}=e;{e.s({patchFetch:()=>a,routeModule:()=>r,serverHooks:()=>d,workAsyncStorage:()=>t,workUnitAsyncStorage:()=>l});var i=e.i(854885),s=e.i(814689),n=e.i(25402),o=e.i(704385);let r=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/v1.1/endpoints/route",pathname:"/api/v1.1/endpoints",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v1.1/endpoints/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:t,workUnitAsyncStorage:l,serverHooks:d}=r;function a(){return(0,n.patchFetch)({workAsyncStorage:t,workUnitAsyncStorage:l})}}},993477:e=>{var{g:r,__dirname:t}=e;e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__c6173fc1._.js","server/chunks/node_modules_10ae7a2d._.js"].map(r=>e.l(r))).then(()=>r(611487)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__840fe99d._.js.map