module.exports={872787:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function n(e){let t=new URLSearchParams;Object.entries(e).forEach(([e,i])=>{null!=i&&t.append(e,String(i))});let i=t.toString();return i?`?${i}`:""}e.s({Inbound:()=>s,InboundEmailClient:()=>s,VERSION:()=>p,buildQueryString:()=>n,default:()=>s,getAttachmentInfo:()=>o,getEmailHtml:()=>d,getEmailText:()=>l,getRecipientAddresses:()=>c,getSenderInfo:()=>u,isInboundWebhook:()=>a,isValidEmail:()=>r});var s=class{constructor(e){if(this.mail={list:async e=>{let t=e?n(e):"";return this.request(`/mail${t}`)},get:async e=>this.request(`/mail/${e}`),reply:async e=>this.request("/mail",{method:"POST",body:JSON.stringify(e)})},this.endpoints={list:async e=>{let t=e?n(e):"";return this.request(`/endpoints${t}`)},create:async e=>this.request("/endpoints",{method:"POST",body:JSON.stringify(e)}),get:async e=>this.request(`/endpoints/${e}`),update:async(e,t)=>this.request(`/endpoints/${e}`,{method:"PUT",body:JSON.stringify(t)}),delete:async e=>this.request(`/endpoints/${e}`,{method:"DELETE"})},this.domains={list:async e=>{let t=e?n(e):"";return this.request(`/domains${t}`)},create:async e=>this.request("/domains",{method:"POST",body:JSON.stringify(e)}),get:async e=>this.request(`/domains/${e}`),update:async(e,t)=>this.request(`/domains/${e}`,{method:"PUT",body:JSON.stringify(t)})},this.emailAddresses={list:async e=>{let t=e?n(e):"";return this.request(`/email-addresses${t}`)},create:async e=>this.request("/email-addresses",{method:"POST",body:JSON.stringify(e)}),get:async e=>this.request(`/email-addresses/${e}`),update:async(e,t)=>this.request(`/email-addresses/${e}`,{method:"PUT",body:JSON.stringify(t)}),delete:async e=>this.request(`/email-addresses/${e}`,{method:"DELETE"})},this.emails={send:async e=>this.request("/emails",{method:"POST",body:JSON.stringify(e)}),get:async e=>this.request(`/emails/${e}`),reply:async(e,t)=>this.request(`/emails/${e}/reply`,{method:"POST",body:JSON.stringify(t)})},this.send=async e=>this.emails.send(e),this.reply=async(e,t)=>{let i="string"==typeof e?e:e.id;if("string"==typeof t){if(!this.defaultReplyFrom)throw Error(`To use simple string replies like inbound.reply(email, "thanks"), you need to configure a defaultReplyFrom address:

const inbound = new Inbound({
  apiKey: "your-key",
  defaultReplyFrom: "support@yourdomain.com"
})

Or use the full syntax: inbound.reply(email, { from: "support@yourdomain.com", text: "thanks" })`);return this.emails.reply(i,{from:this.defaultReplyFrom,text:t})}let r={...t};if(!r.from&&this.defaultReplyFrom&&(r.from=this.defaultReplyFrom),!r.from)throw Error(`Reply requires a "from" address. Either:
1. Configure defaultReplyFrom: new Inbound({ apiKey: "key", defaultReplyFrom: "support@domain.com" })
2. Or provide it in the reply: inbound.reply(email, { from: "support@domain.com", text: "thanks" })`);return this.emails.reply(i,r)},this.endpoint=this.endpoints,this.domain=this.domains,this.emailAddress=this.emailAddresses,this.email=this.emails,"string"==typeof e?(this.apiKey=e,this.baseUrl="https://inbound.new/api/v2",this.defaultReplyFrom=void 0):(this.apiKey=e.apiKey,this.baseUrl=e.baseUrl||"https://inbound.new/api/v2",this.defaultReplyFrom=e.defaultReplyFrom),!this.apiKey)throw Error("API key is required")}async request(e,t={}){let i=`${this.baseUrl}${e}`,r={Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json",...t.headers},n=await fetch(i,{...t,headers:r});if(!n.ok)throw Error((await n.json().catch(()=>({}))).error||`HTTP ${n.status}: ${n.statusText}`);return n.json()}};function a(e){return e&&"object"==typeof e&&"email.received"===e.event&&"string"==typeof e.timestamp&&e.email&&"object"==typeof e.email&&"string"==typeof e.email.id&&e.endpoint&&"object"==typeof e.endpoint&&"string"==typeof e.endpoint.id}function o(e){let t=e.contentType?.toLowerCase()||"";return{...e,hasContent:!!e.size&&e.size>0,isImage:t.startsWith("image/"),isDocument:t.includes("pdf")||t.includes("document")||t.includes("text/")||t.includes("application/msword")||t.includes("application/vnd.openxmlformats")}}function l(e){return e.cleanedContent.text||e.parsedData.textBody||(e.cleanedContent.html?e.cleanedContent.html.replace(/<[^>]*>/g,""):"")||""}function d(e){return e.cleanedContent.html||e.parsedData.htmlBody||(e.cleanedContent.text?e.cleanedContent.text.replace(/\n/g,"<br>"):"")||""}function u(e){let t=e.from||e.parsedData.from;if(!t||!t.addresses||0===t.addresses.length)return{name:null,address:null};let i=t.addresses[0];return{name:i.name,address:i.address}}function c(e){let t=e.to||e.parsedData.to;return t&&t.addresses?t.addresses.map(e=>e.address).filter(e=>null!==e):[e.recipient]}var p="2.0.0"},473925:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({Heading:()=>g});var r=e.i(535540),n=e.i(692339),s=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,c=(e,t,i)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,p=(e,t)=>{for(var i in t||(t={}))d.call(t,i)&&c(e,i,t[i]);if(l)for(var i of l(t))u.call(t,i)&&c(e,i,t[i]);return e},m=(e,t)=>a(e,o(t)),y=(e,t)=>{var i={};for(var r in e)d.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&l)for(var r of l(e))0>t.indexOf(r)&&u.call(e,r)&&(i[r]=e[r]);return i},f=e=>[h(e.m,["margin"]),h(e.mx,["marginLeft","marginRight"]),h(e.my,["marginTop","marginBottom"]),h(e.mt,["marginTop"]),h(e.mr,["marginRight"]),h(e.mb,["marginBottom"]),h(e.ml,["marginLeft"])].filter(e=>Object.keys(e).length).reduce((e,t)=>p(p({},e),t),{}),h=(e,t)=>t.reduce((t,i)=>isNaN(parseFloat(e))?t:m(p({},t),{[i]:`${e}px`}),{}),g=(0,r.forwardRef)((e,t)=>{var{as:i="h1",children:r,style:s,m:a,mx:o,my:l,mt:d,mr:u,mb:c,ml:h}=e,g=y(e,["as","children","style","m","mx","my","mt","mr","mb","ml"]);return(0,n.jsx)(i,m(p({},g),{ref:t,style:p(p({},f({m:a,mx:o,my:l,mt:d,mr:u,mb:c,ml:h})),s),children:r}))});g.displayName="Heading"},975501:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({Hr:()=>f});var r=e.i(535540),n=e.i(692339),s=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,c=(e,t,i)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,p=(e,t)=>{for(var i in t||(t={}))d.call(t,i)&&c(e,i,t[i]);if(l)for(var i of l(t))u.call(t,i)&&c(e,i,t[i]);return e},m=(e,t)=>a(e,o(t)),y=(e,t)=>{var i={};for(var r in e)d.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&l)for(var r of l(e))0>t.indexOf(r)&&u.call(e,r)&&(i[r]=e[r]);return i},f=(0,r.forwardRef)((e,t)=>{var{style:i}=e,r=y(e,["style"]);return(0,n.jsx)("hr",m(p({},r),{ref:t,style:p({width:"100%",border:"none",borderTop:"1px solid #eaeaea"},i)}))});f.displayName="Hr"},739564:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({VipPaymentRequestEmail:()=>t,default:()=>i});var r=e.i(692339),n=e.i(843088),s=e.i(319148),a=e.i(396931),o=e.i(433219),l=e.i(473925),d=e.i(975501),u=e.i(50154),c=e.i(922041),p=e.i(47063),m=e.i(877720),y=e.i(669510),f=e.i(486862);let t=({senderName:e,senderEmail:t,recipientName:i,recipientEmail:q,emailSubject:T,priceInCents:C,customMessage:N,paymentUrl:H,allowAfterPayment:U,expirationHours:D})=>{let _=(C/100).toFixed(2);return(0,r.jsxs)(u.Html,{children:[(0,r.jsx)(o.Head,{}),(0,r.jsxs)(m.Preview,{children:["Payment required to deliver your email to ",q]}),(0,r.jsx)(n.Body,{style:h,children:(0,r.jsxs)(a.Container,{style:g,children:[(0,r.jsx)(c.Img,{src:`${process.env.NEXT_PUBLIC_APP_URL}/logo.png`,width:"120",height:"36",alt:"Inbound",style:x}),(0,r.jsx)(l.Heading,{style:b,children:"Payment Required"}),(0,r.jsxs)(f.Text,{style:v,children:["Hi ",e,","]}),(0,r.jsxs)(f.Text,{style:v,children:["You're trying to reach ",(0,r.jsx)("strong",{children:i})," at"," ",(0,r.jsx)(p.Link,{href:`mailto:${q}`,style:w,children:q}),", but they require a payment of ",(0,r.jsxs)("strong",{children:["$",_]})," to receive emails from new senders."]}),N&&(0,r.jsx)(y.Section,{style:j,children:(0,r.jsx)(f.Text,{style:P,children:N})}),(0,r.jsxs)(y.Section,{style:I,children:[(0,r.jsx)(f.Text,{style:S,children:"Your email subject:"}),(0,r.jsx)(f.Text,{style:E,children:T})]}),(0,r.jsx)(y.Section,{style:R,children:(0,r.jsxs)(s.Button,{style:A,href:H,children:["Pay $",_," to Deliver Email"]})}),(0,r.jsx)(f.Text,{style:k,children:U?"After payment, all your future emails to this address will be delivered automatically.":"This payment covers delivery of your current email only."}),(0,r.jsxs)(f.Text,{style:k,children:["This payment link expires in ",D," hours."]}),(0,r.jsx)(d.Hr,{style:$}),(0,r.jsxs)(f.Text,{style:O,children:["Powered by"," ",(0,r.jsx)(p.Link,{href:"https://inbound.new",style:w,children:"Inbound"})," ","â€¢ VIP Email Protection"]})]})})]})};t.PreviewProps={senderName:"John Doe",senderEmail:"john@example.com",recipientName:"Jane Smith",recipientEmail:"jane@company.com",emailSubject:"Proposal for Q4 Marketing Campaign",priceInCents:500,customMessage:"I value my time and use VIP protection to ensure only serious inquiries reach my inbox.",paymentUrl:"https://checkout.stripe.com/example",allowAfterPayment:!0,expirationHours:24};let i=t,h={backgroundColor:"#f6f9fc",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},g={backgroundColor:"#ffffff",margin:"0 auto",padding:"20px 0 48px",marginBottom:"64px"},x={margin:"0 auto",marginBottom:"32px"},b={fontSize:"32px",lineHeight:"1.3",fontWeight:"700",color:"#484848",textAlign:"center",margin:"30px 0"},v={fontSize:"16px",lineHeight:"26px",color:"#484848",margin:"16px 0"},w={color:"#6C47FF",textDecoration:"none"},j={backgroundColor:"#f4f4f5",borderRadius:"8px",padding:"16px",margin:"24px 0"},P={fontSize:"14px",lineHeight:"24px",color:"#666666",fontStyle:"italic",margin:0},I={margin:"24px 0"},S={fontSize:"14px",color:"#666666",margin:"0 0 4px 0"},E={fontSize:"16px",color:"#484848",fontWeight:"600",margin:0},R={textAlign:"center",margin:"32px 0"},A={backgroundColor:"#6C47FF",borderRadius:"6px",color:"#fff",fontSize:"16px",fontWeight:"600",textDecoration:"none",textAlign:"center",display:"inline-block",padding:"12px 24px"},k={fontSize:"14px",lineHeight:"24px",color:"#666666",textAlign:"center",margin:"8px 0"},$={borderColor:"#e6ebf1",margin:"32px 0"},O={color:"#8898aa",fontSize:"12px",lineHeight:"16px",textAlign:"center"}}},950884:e=>{"use strict";var{g:t,__dirname:i,a:r}=e;r(async(t,i)=>{try{e.s({default:()=>o,generateVipPaymentRequestEmail:()=>l});var r=e.i(692339),n=e.i(739564),s=e.i(611487),a=t([s]);function o(){return(0,r.jsx)(n.default,{senderName:"John Doe",senderEmail:"john@example.com",recipientName:"Jane Smith",recipientEmail:"jane@company.com",emailSubject:"Proposal for Q4 Marketing Campaign",priceInCents:500,customMessage:"I value my time and use VIP protection to ensure only serious inquiries reach my inbox.",paymentUrl:"https://checkout.stripe.com/example",allowAfterPayment:!0,expirationHours:24})}async function l(e){return await (0,s.renderAsync)((0,r.jsx)(n.default,{...e}))}[s]=a.then?(await a)():a,i()}catch(e){i(e)}},!1)},44778:e=>{"use strict";var{g:t,__dirname:i,a:r}=e;r(async(t,i)=>{try{e.s({POST:()=>y});var r=e.i(125427),n=e.i(872787),s=e.i(557440);e.i(468686);var a=e.i(55379),o=e.i(594120),l=e.i(176825),d=e.i(318812),u=e.i(74048),c=e.i(950884),p=t([c]);[c]=p.then?(await p)():p;let f=new u.default(process.env.STRIPE_SECRET_KEY);async function m(e){try{let t=await s.db.select({key:o.apikey.key}).from(o.apikey).where((0,l.and)((0,l.eq)(o.apikey.userId,e),(0,l.eq)(o.apikey.enabled,!0))).limit(1);return t[0]?.key||null}catch(e){return console.error("Error retrieving user API key:",e),null}}async function y(e){try{let t=await e.json();if(!(0,n.isInboundWebhook)(t))return r.NextResponse.json({error:"Invalid webhook payload"},{status:400});let{email:i}=t,o=i.to?.addresses?.[0]?.address;if(!o)return console.error("No recipient email found"),r.NextResponse.json({success:!0});let p=await s.db.select().from(a.emailAddresses).where((0,l.eq)(a.emailAddresses.address,o)).limit(1);if(!p[0]?.isVipEnabled||!p[0]?.vipConfigId)return console.log("Email is not VIP-enabled, processing normally"),r.NextResponse.json({success:!0});let y=await s.db.select().from(a.vipConfigs).where((0,l.eq)(a.vipConfigs.id,p[0].vipConfigId)).limit(1);if(!y[0]||!y[0].isActive)return console.log("VIP config not found or inactive"),r.NextResponse.json({success:!0});let h=i.from?.addresses?.[0]?.address;if(!h)return console.error("No sender email found"),r.NextResponse.json({success:!0});let g=await s.db.select().from(a.vipAllowedSenders).where((0,l.and)((0,l.eq)(a.vipAllowedSenders.vipConfigId,y[0].id),(0,l.eq)(a.vipAllowedSenders.senderEmail,h))).limit(1);if(g[0]&&(!g[0].allowedUntil||new Date(g[0].allowedUntil)>new Date))return console.log("Sender is allowed, delivering email"),await s.db.insert(a.vipEmailAttempts).values({id:(0,d.nanoid)(),vipConfigId:y[0].id,senderEmail:h,recipientEmail:o,originalEmailId:i.id,emailSubject:i.subject,status:"allowed",allowedReason:"previous_payment",createdAt:new Date,updatedAt:new Date}),r.NextResponse.json({success:!0});let x=await m(y[0].userId);if(!x)return console.error("No API key found for user:",y[0].userId),r.NextResponse.json({error:"User API key not found"},{status:500});let b=new n.Inbound({apiKey:x,defaultReplyFrom:"payments@inbound.new"}),v=await s.db.select().from(a.userAccounts).where((0,l.eq)(a.userAccounts.userId,y[0].userId)).limit(1),w=v[0]?.stripeRestrictedKey?new u.default(v[0].stripeRestrictedKey):f,j=(0,d.nanoid)(),P=new Date;P.setHours(P.getHours()+(y[0].paymentLinkExpirationHours||24));let I=await w.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:`Email delivery to ${o}`,description:y[0].customMessage||`Pay to deliver your email to ${o}. ${y[0].allowAfterPayment?"After payment, all your future emails will be delivered automatically.":"This payment covers delivery of your current email only."}`},unit_amount:y[0].priceInCents},quantity:1}],mode:"payment",metadata:{sessionId:j,vipConfigId:y[0].id,senderEmail:h,recipientEmail:o,emailId:i.id},success_url:`${process.env.NEXT_PUBLIC_APP_URL}/api/products/inboundvip/success?session_id=${j}`,cancel_url:`${process.env.NEXT_PUBLIC_APP_URL}/api/products/inboundvip/cancelled`,expires_at:Math.floor(P.getTime()/1e3)});await s.db.insert(a.vipPaymentSessions).values({id:j,vipConfigId:y[0].id,senderEmail:h,originalEmailId:i.id,stripePaymentLinkId:I.id,stripePaymentLinkUrl:I.url,stripeSessionId:I.id,status:"pending",expiresAt:P,createdAt:new Date,updatedAt:new Date}),await s.db.insert(a.vipEmailAttempts).values({id:(0,d.nanoid)(),vipConfigId:y[0].id,senderEmail:h,recipientEmail:o,originalEmailId:i.id,emailSubject:i.subject,status:"payment_required",paymentSessionId:j,createdAt:new Date,updatedAt:new Date});let S=i.to?.addresses?.[0]?.name||o.split("@")[0],E=i.from?.addresses?.[0]?.name||h,R=await (0,c.generateVipPaymentRequestEmail)({senderName:E,senderEmail:h,recipientName:S,recipientEmail:o,emailSubject:i.subject||"No subject",priceInCents:y[0].priceInCents,customMessage:y[0].customMessage||void 0,paymentUrl:I.url,allowAfterPayment:y[0].allowAfterPayment||!1,expirationHours:y[0].paymentLinkExpirationHours||24});return await b.reply(i,{from:"payments@inbound.new",subject:`Payment Required: ${i.subject}`,html:R,text:`Payment Required to Deliver Your Email

Hi ${E},

You're trying to reach ${S} at ${o}, but they require a payment of $${(y[0].priceInCents/100).toFixed(2)} to receive emails from new senders.

${y[0].customMessage||""}

Your email subject: ${i.subject}

Pay here: ${I.url}

${y[0].allowAfterPayment?"After payment, all your future emails to this address will be delivered automatically.":"This payment covers delivery of your current email only."}

This payment link expires in ${y[0].paymentLinkExpirationHours} hours.`}),console.log(`VIP payment request sent to ${h} for ${o}`),r.NextResponse.json({success:!0})}catch(e){return console.error("Webhook error:",e),r.NextResponse.json({error:"Internal server error"},{status:500})}}i()}catch(e){i(e)}},!1)},941852:e=>{"use strict";var{g:t,__dirname:i,a:r}=e;r(async(t,i)=>{try{e.s({patchFetch:()=>l,routeModule:()=>d,serverHooks:()=>p,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>c});var r=e.i(854885),n=e.i(814689),s=e.i(25402),a=e.i(44778),o=t([a]);[a]=o.then?(await o)():o;let d=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/products/inboundvip/route",pathname:"/api/products/inboundvip",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/products/inboundvip/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:u,workUnitAsyncStorage:c,serverHooks:p}=d;function l(){return(0,s.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:c})}i()}catch(e){i(e)}},!1)}};

//# sourceMappingURL=_38925c34._.js.map