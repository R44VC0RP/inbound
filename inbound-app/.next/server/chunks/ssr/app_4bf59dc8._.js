module.exports={164351:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({toggleVipStatus:()=>e});var d=a.i(283620),e=(0,d.createServerReference)("60da52dde5a2616fa146bcde823ecad23fe1644322",d.callServer,void 0,d.findSourceMapURL,"toggleVipStatus")},366707:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({updateVipConfig:()=>e});var d=a.i(283620),e=(0,d.createServerReference)("600958c8c97bc2260e7a61a589de77ee3220ef2a36",d.callServer,void 0,d.findSourceMapURL,"updateVipConfig")},376272:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({updateAccountStripeKey:()=>e});var d=a.i(283620),e=(0,d.createServerReference)("401aa170a6c916d095059400d40e8925ec001c2a85",d.callServer,void 0,d.findSourceMapURL,"updateAccountStripeKey")},855269:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({default:()=>D});var d=a.i(674420),e=a.i(722851),f=a.i(123546),g=a.i(925261),h=a.i(238769),i=a.i(378903),j=a.i(668018),k=a.i(386483),l=a.i(974137),m=a.i(487085),n=a.i(576104),o=a.i(550216),p=a.i(164351),q=a.i(366707),r=a.i(376272),s=a.i(323772),t=a.i(566825),u=a.i(569164),v=a.i(372667),w=a.i(342064),x=a.i(195743),y=a.i(180214),z=a.i(816486);a.i(779128);var A=a.i(805175),B=a.i(969405),C=a.i(918656);function D({addresses:a,recentSessions:b,allowedCountMap:c,hasVipByok:D,accountStripeKey:E,emailAttempts:F}){let[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)({}),{attach:K}=(0,A.useAutumn)(),L=(0,C.useRouter)(),M=(0,C.useSearchParams)(),N=async(a,b)=>{H(a);try{let c=await (0,p.toggleVipStatus)(a,b);c.error?s.toast.error(c.error):s.toast.success(b?"VIP protection enabled":"VIP protection disabled")}catch(a){s.toast.error("Failed to update VIP status")}finally{H(null)}},O=async a=>{a.preventDefault();let b=new FormData(a.currentTarget),c=b.get("vipConfigId");H(c);try{let a=await (0,q.updateVipConfig)(c,{price:b.get("price"),expirationHours:b.get("expirationHours"),allowAfterPayment:"on"===b.get("allowAfterPayment"),customMessage:b.get("customMessage")});a.error?s.toast.error(a.error):s.toast.success("VIP configuration updated")}catch(a){s.toast.error("Failed to update VIP configuration")}finally{H(null)}},P=async a=>{a.preventDefault();let b=new FormData(a.currentTarget).get("accountStripeKey");H("account-stripe-key");try{let c=await (0,r.updateAccountStripeKey)(b);c.error?s.toast.error(c.error):(s.toast.success("Account Stripe key updated"),J(a=>({...a,"stripe-key-form":!1})),a.currentTarget.reset())}catch(a){s.toast.error("Failed to update account Stripe key")}finally{H(null)}},Q=a=>{J(b=>({...b,[a]:!b[a]}))},R=async()=>{try{await K({productId:"inbound_vip",successUrl:`${window.location.origin}/vip?upgrade=true`,dialog:B.default})}catch(a){console.error("Error upgrading to VIP BYOK:",a),s.toast.error("Failed to start upgrade process")}};return(0,e.useEffect)(()=>{if("true"===M.get("upgrade")){s.toast.success("Successfully upgraded to VIP BYOK! You can now use your own Stripe key.");let a=new URL(window.location.href);a.searchParams.delete("upgrade"),L.replace(a.pathname+a.search)}},[M,L]),(0,d.jsx)("div",{className:"min-h-screen font-outfit",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto p-4",children:[(0,d.jsx)("div",{className:"mb-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-2xl font-semibold text-foreground mb-1 tracking-tight",children:"VIP Email Management"}),(0,d.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:"Require payment from new senders to reach your inbox"})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[D&&E&&(0,d.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-2 bg-accent border border-border rounded-lg",children:[(0,d.jsx)(x.default,{width:"16",height:"16",className:"text-green-600 dark:text-green-400"}),(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("span",{className:"font-medium text-foreground",children:"Stripe Key Loaded: "}),(0,d.jsxs)("span",{className:"text-muted-foreground",children:[E.substring(0,5),"•••••"]})]}),(0,d.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>J(a=>({...a,"stripe-key-form":!a["stripe-key-form"]})),children:"Replace"}),(0,d.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive/80",onClick:async()=>{if(confirm("Are you sure you want to remove your Stripe key? Future VIP payments will be processed through Inbound's account.")){H("account-stripe-key");try{let a=await (0,r.updateAccountStripeKey)("");a.error?s.toast.error(a.error):s.toast.success("Stripe key removed. Using Inbound's account for VIP payments.")}catch(a){s.toast.error("Failed to remove Stripe key")}finally{H(null)}}},disabled:"account-stripe-key"===G,children:"Remove"})]}),!D&&(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:R,children:[(0,d.jsx)(o.default,{className:"h-3 w-3 mr-1.5 text-yellow-500"}),"Upgrade to VIP BYOK"]})]})]})}),D&&E&&I["stripe-key-form"]&&(0,d.jsxs)(f.Card,{className:"bg-card border-border rounded-xl mb-6",children:[(0,d.jsxs)(f.CardHeader,{children:[(0,d.jsx)(f.CardTitle,{className:"text-lg font-semibold text-foreground tracking-tight",children:"Replace Stripe Key"}),(0,d.jsx)(f.CardDescription,{className:"text-sm text-muted-foreground",children:"Update your Stripe restricted key for VIP payments"})]}),(0,d.jsx)(f.CardContent,{children:(0,d.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{htmlFor:"accountStripeKey",className:"text-sm font-medium",children:"New Stripe Restricted Key"}),(0,d.jsx)(j.Input,{id:"accountStripeKey",name:"accountStripeKey",type:"password",placeholder:"rk_live_...",className:"mt-1"}),(0,d.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter your new Stripe restricted key"}),(0,d.jsx)(i.Button,{type:"button",variant:"ghost",size:"sm",className:"text-xs p-0 h-auto text-primary hover:text-primary/80",onClick:()=>window.open("https://dashboard.stripe.com/apikeys/create?name=Inbound%20VIP&permissions%5B%5D=rak_charge_write&permissions%5B%5D=rak_checkout_session_write&permissions%5B%5D=rak_payment_link_write","_blank"),children:"Create in Stripe →"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>J(a=>({...a,"stripe-key-form":!1})),children:"Cancel"}),(0,d.jsx)(i.Button,{type:"submit",size:"sm",disabled:"account-stripe-key"===G,children:"account-stripe-key"===G?"Saving...":"Update Key"})]})]})})]}),D&&!E&&(0,d.jsxs)(f.Card,{className:"bg-card border-border rounded-xl mb-6",children:[(0,d.jsxs)(f.CardHeader,{children:[(0,d.jsx)(f.CardTitle,{className:"text-lg font-semibold text-foreground tracking-tight",children:"Account Settings"}),(0,d.jsx)(f.CardDescription,{className:"text-sm text-muted-foreground",children:"Configure your account-level VIP settings"})]}),(0,d.jsx)(f.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("div",{className:"p-4 bg-muted border border-border rounded-lg",children:(0,d.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,d.jsx)(y.default,{width:"20",height:"20",className:"text-orange-600 dark:text-orange-400 mt-0.5"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Using Inbound's Stripe Account"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"VIP payments are currently processed through Inbound's Stripe account. Add your own Stripe restricted key to collect payments directly."})]})]})}),(0,d.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{htmlFor:"accountStripeKey",className:"text-sm font-medium",children:"Account Stripe Restricted Key (Optional)"}),(0,d.jsx)(j.Input,{id:"accountStripeKey",name:"accountStripeKey",type:"password",placeholder:"rk_live_...",className:"mt-1"}),(0,d.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use your own Stripe account to collect VIP payments directly"}),(0,d.jsx)(i.Button,{type:"button",variant:"ghost",size:"sm",className:"text-xs p-0 h-auto text-primary hover:text-primary/80",onClick:()=>window.open("https://dashboard.stripe.com/apikeys/create?name=Inbound%20VIP&permissions%5B%5D=rak_charge_write&permissions%5B%5D=rak_checkout_session_write&permissions%5B%5D=rak_payment_link_write","_blank"),children:"Create Restricted Key in Stripe →"})]})]}),(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)(i.Button,{type:"submit",size:"sm",disabled:"account-stripe-key"===G,children:"account-stripe-key"===G?"Saving...":"Add Stripe Key"})})]})]})})]}),(0,d.jsx)("div",{className:"space-y-2 mb-6",children:0===a.length?(0,d.jsx)(f.Card,{className:"bg-card border-border rounded-xl",children:(0,d.jsx)(f.CardContent,{className:"p-8",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)(t.CustomInboundIcon,{Icon:o.default,size:48,backgroundColor:"#eab308",className:"mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"No email addresses configured. Add email addresses in the Domains section first."}),(0,d.jsx)(i.Button,{variant:"secondary",asChild:!0,children:(0,d.jsx)(z.default,{href:"/emails",children:"Go to Domains"})})]})})}):a.map(({emailAddress:a,domain:b,vipConfig:e})=>(0,d.jsx)(f.Card,{className:"bg-card border-border hover:bg-accent/5 transition-all duration-300 rounded-xl overflow-hidden group",children:(0,d.jsxs)(f.CardContent,{className:"p-0",children:[(0,d.jsx)("div",{className:"p-4 border-b border-border",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)(t.CustomInboundIcon,{Icon:u.default,size:36,backgroundColor:a.isVipEnabled?"#eab308":"#64748b"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-base font-semibold text-foreground tracking-tight",children:a.address}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 mt-0.5",children:[(0,d.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:b?.domain||"Unknown domain"}),a.isVipEnabled&&e&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"•"}),(0,d.jsxs)("span",{className:"text-xs text-muted-foreground font-medium",children:["$",(e.priceInCents/100).toFixed(2)," per email"]}),(0,d.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"•"}),(0,d.jsxs)("span",{className:"text-xs text-muted-foreground font-medium",children:[c[e.id]||0," allowed senders"]})]})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[a.isVipEnabled&&e&&(0,d.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>Q(e.id),className:"h-8 px-2",children:[(0,d.jsx)(w.default,{width:"14",height:"14",className:"mr-1"}),"Config",(0,d.jsx)(v.default,{width:"14",height:"14",className:`ml-1 transition-transform duration-200 ${I[e.id]?"rotate-180":""}`})]}),(0,d.jsx)(l.Switch,{checked:a.isVipEnabled||!1,disabled:G===a.id,onCheckedChange:b=>N(a.id,b)})]})]})}),a.isVipEnabled&&e&&(0,d.jsx)("div",{className:"bg-muted/50 overflow-hidden transition-all duration-300 ease-in-out",style:{maxHeight:I[e.id]?"400px":"0px",opacity:+!!I[e.id]},children:(0,d.jsxs)("form",{onSubmit:O,className:"p-4 space-y-4",children:[(0,d.jsx)("input",{type:"hidden",name:"vipConfigId",value:e.id}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{htmlFor:`price-${e.id}`,className:"text-xs",children:"Price (USD)"}),(0,d.jsxs)("div",{className:"relative mt-1",children:[(0,d.jsx)("span",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:"$"}),(0,d.jsx)(j.Input,{id:`price-${e.id}`,name:"price",type:"number",step:"0.01",min:"0.01",defaultValue:(e.priceInCents/100).toFixed(2),className:"pl-7 h-8 text-sm"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{htmlFor:`expiration-${e.id}`,className:"text-xs",children:"Link Expiration (hours)"}),(0,d.jsx)(j.Input,{id:`expiration-${e.id}`,name:"expirationHours",type:"number",min:"1",max:"168",defaultValue:e.paymentLinkExpirationHours||24,className:"h-8 text-sm mt-1"})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(l.Switch,{id:`allow-future-${e.id}`,name:"allowAfterPayment",defaultChecked:e.allowAfterPayment||!1}),(0,d.jsx)(k.Label,{htmlFor:`allow-future-${e.id}`,className:"text-sm",children:"Allow all future emails after payment"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{htmlFor:`message-${e.id}`,className:"text-xs",children:"Custom Message (optional)"}),(0,d.jsx)(m.Textarea,{id:`message-${e.id}`,name:"customMessage",placeholder:"Add a custom message to the payment request email...",defaultValue:e.customMessage||"",rows:2,className:"text-sm mt-1"})]}),(0,d.jsx)("div",{className:"flex justify-end pt-2",children:(0,d.jsx)(i.Button,{type:"submit",size:"sm",disabled:G===e.id,children:G===e.id?"Saving...":"Save Changes"})})]})})]})},a.id))}),(0,d.jsxs)("div",{className:"mt-8",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"VIP Email Log"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Track all emails that hit your VIP protection and their payment status"}),F.length>0?(0,d.jsx)(f.Card,{className:"bg-card border-border rounded-xl",children:(0,d.jsxs)(g.Table,{children:[(0,d.jsx)(g.TableHeader,{children:(0,d.jsxs)(g.TableRow,{className:"border-b border-border",children:[(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Sender"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Recipient"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Subject"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Status"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Payment Status"}),(0,d.jsx)(g.TableHead,{className:"text-xs text-right",children:"Received"})]})}),(0,d.jsx)(g.TableBody,{children:F.map(({attempt:a,paymentSession:b})=>(0,d.jsxs)(g.TableRow,{className:"border-b border-border",children:[(0,d.jsx)(g.TableCell,{className:"text-sm py-3",children:(0,d.jsx)("div",{className:"max-w-[150px] truncate",children:a.senderEmail})}),(0,d.jsx)(g.TableCell,{className:"text-sm py-3",children:(0,d.jsx)("div",{className:"max-w-[150px] truncate",children:a.recipientEmail})}),(0,d.jsx)(g.TableCell,{className:"text-sm py-3",children:(0,d.jsx)("div",{className:"max-w-[200px] truncate",children:a.emailSubject||"No subject"})}),(0,d.jsx)(g.TableCell,{className:"py-3",children:(0,d.jsxs)(h.Badge,{variant:"allowed"===a.status?"secondary":"payment_required"===a.status?"outline":"secondary",className:"text-xs",children:["allowed"===a.status&&(0,d.jsx)(x.default,{width:"10",height:"10",className:"mr-1"}),"payment_required"===a.status&&(0,d.jsx)(y.default,{width:"10",height:"10",className:"mr-1"}),"allowed"===a.status?"Allowed":"payment_required"===a.status?"Payment Required":a.status]})}),(0,d.jsx)(g.TableCell,{className:"py-3",children:b?(0,d.jsxs)(h.Badge,{variant:"paid"===b.status?"secondary":"pending"===b.status?"outline":"expired"===b.status?"destructive":"secondary",className:"text-xs",children:["paid"===b.status&&(0,d.jsx)(x.default,{width:"10",height:"10",className:"mr-1"}),"pending"===b.status&&(0,d.jsx)(y.default,{width:"10",height:"10",className:"mr-1"}),b.status]}):(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:"N/A"})}),(0,d.jsx)(g.TableCell,{className:"text-sm text-muted-foreground text-right py-3",children:(0,n.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]},a.id))})]})}):(0,d.jsx)(f.Card,{className:"bg-card border-border rounded-xl",children:(0,d.jsx)(f.CardContent,{className:"p-8",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)(t.CustomInboundIcon,{Icon:u.default,size:48,backgroundColor:"#64748b",className:"mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"No VIP email attempts yet. Once you enable VIP protection on your email addresses, all incoming emails will be logged here."})]})})})]})]})})}}};

//# sourceMappingURL=app_4bf59dc8._.js.map