module.exports={785366:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({createWebhook:()=>n,deleteWebhook:()=>p,getWebhook:()=>m,getWebhooks:()=>l,testWebhook:()=>q,updateWebhook:()=>o});var d=a.i(930768);a.i(996945);var e=a.i(107729),f=a.i(409950),g=a.i(900707);a.i(508384);var h=a.i(954523),i=a.i(988777),j=a.i(329295),k=a.i(719358);async function l(){try{let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{error:"Unauthorized"};let b=await g.db.select().from(h.webhooks).where((0,i.eq)(h.webhooks.userId,a.user.id)).orderBy(h.webhooks.createdAt);return{success:!0,webhooks:b}}catch(a){return console.error("Error fetching webhooks:",a),{error:"Failed to fetch webhooks"}}}async function m(a){try{let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{error:"Unauthorized"};let[c]=await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,b.user.id))).limit(1);if(!c)return{error:"Webhook not found"};return{success:!0,webhook:c}}catch(a){return console.error("Error fetching webhook:",a),{error:"Failed to fetch webhook"}}}async function n(a){try{let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{error:"Unauthorized"};let{name:c,url:d,description:l,headers:m,timeout:n,retryAttempts:o}=a;if(!c||!d)return{error:"Name and URL are required"};try{new URL(d)}catch{return{error:"Invalid URL format"}}if((await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.userId,b.user.id),(0,i.eq)(h.webhooks.name,c))).limit(1)).length>0)return{error:"A webhook with this name already exists"};let p=(0,j.randomBytes)(32).toString("hex"),q={id:(0,j.randomBytes)(16).toString("hex"),name:c,url:d,description:l||null,secret:p,headers:m?JSON.stringify(m):null,timeout:n||30,retryAttempts:o||3,userId:b.user.id,isActive:!0},[r]=await g.db.insert(h.webhooks).values(q).returning();return(0,k.revalidatePath)("/webhooks"),(0,k.revalidatePath)("/emails"),{success:!0,webhook:r}}catch(a){return console.error("Error creating webhook:",a),{error:"Failed to create webhook"}}}async function o(a,b){try{let c=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!c?.user)return{error:"Unauthorized"};let{name:d,url:j,description:l,isActive:m,headers:n,timeout:o,retryAttempts:p}=b;if(j)try{new URL(j)}catch{return{error:"Invalid URL format"}}let[q]=await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,c.user.id))).limit(1);if(!q)return{error:"Webhook not found"};if(d&&d!==q.name){let b=await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.userId,c.user.id),(0,i.eq)(h.webhooks.name,d))).limit(1);if(b.length>0&&b[0].id!==a)return{error:"A webhook with this name already exists"}}let r={updatedAt:new Date};void 0!==d&&(r.name=d),void 0!==j&&(r.url=j),void 0!==l&&(r.description=l),void 0!==m&&(r.isActive=m),void 0!==n&&(r.headers=n?JSON.stringify(n):null),void 0!==o&&(r.timeout=o),void 0!==p&&(r.retryAttempts=p);let[s]=await g.db.update(h.webhooks).set(r).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,c.user.id))).returning();return(0,k.revalidatePath)("/webhooks"),(0,k.revalidatePath)("/emails"),{success:!0,webhook:s}}catch(a){return console.error("Error updating webhook:",a),{error:"Failed to update webhook"}}}async function p(a){try{let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{error:"Unauthorized"};let[c]=await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,b.user.id))).limit(1);if(!c)return{error:"Webhook not found"};return await g.db.delete(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,b.user.id))),(0,k.revalidatePath)("/webhooks"),(0,k.revalidatePath)("/emails"),{success:!0,message:"Webhook deleted successfully"}}catch(a){return console.error("Error deleting webhook:",a),{error:"Failed to delete webhook"}}}async function q(a){try{let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{error:"Unauthorized"};let[c]=await g.db.select().from(h.webhooks).where((0,i.and)((0,i.eq)(h.webhooks.id,a),(0,i.eq)(h.webhooks.userId,b.user.id))).limit(1);if(!c)return{error:"Webhook not found"};if(!c.isActive)return{error:"Webhook is disabled"};let d={event:"webhook_test",timestamp:new Date().toISOString(),webhook_id:c.id,test:!0,data:{message:"This is a test webhook delivery from Inbound"}},j={"Content-Type":"application/json","User-Agent":"Inbound-Webhook/1.0","X-Webhook-Signature":c.secret||""};if(c.headers)try{let a=JSON.parse(c.headers);Object.assign(j,a)}catch(a){console.error("Error parsing custom headers:",a)}let l=Date.now(),m="",n={};try{console.log(`🔗 Testing webhook: ${c.name} (${c.url})`),console.log(`📤 Test payload:`,JSON.stringify(d,null,2)),console.log(`📋 Request headers:`,JSON.stringify(j,null,2));let b=await fetch(c.url,{method:"POST",headers:j,body:JSON.stringify(d),signal:AbortSignal.timeout(1e3*(c.timeout||30))}),e=Date.now()-l;b.headers.forEach((a,b)=>{n[b]=a});try{m=await b.text()}catch(a){m="Unable to read response body",console.error(`❌ Error reading response body:`,a)}if(console.log(`${b.ok?"✅":"❌"} Webhook test ${b.ok?"succeeded":"failed"}: ${b.status} in ${e}ms`),console.log(`📨 Response headers:`,JSON.stringify(n,null,2)),console.log(`📄 Response body:`,m),await g.db.update(h.webhooks).set({lastUsed:new Date,totalDeliveries:(c.totalDeliveries||0)+1,successfulDeliveries:b.ok?(c.successfulDeliveries||0)+1:c.successfulDeliveries||0,failedDeliveries:b.ok?c.failedDeliveries||0:(c.failedDeliveries||0)+1,updatedAt:new Date}).where((0,i.eq)(h.webhooks.id,a)),(0,k.revalidatePath)("/webhooks"),b.ok)return{success:!0,statusCode:b.status,message:`Webhook test successful! Response: ${b.status}`,responseTime:e,responseBody:m.substring(0,1e3),responseHeaders:n};{let a=`Status: ${b.status} ${b.statusText}`;return console.error(`❌ Webhook test failed - ${a}`),console.error(`❌ Response body:`,m),{success:!1,statusCode:b.status,error:`Webhook test failed with status: ${b.status} ${b.statusText}`,responseTime:e,responseBody:m.substring(0,1e3),responseHeaders:n,details:{url:c.url,timeout:c.timeout||30,statusText:b.statusText}}}}catch(f){let b=Date.now()-l,d="Unknown error",e="network";return"TimeoutError"===f.name||"AbortError"===f.name?(d=`Request timeout after ${c.timeout||30} seconds`,e="timeout"):"TypeError"===f.name&&f.message.includes("fetch")?(d=`Network error: ${f.message}`,e="network"):(d=f.message||"Unknown error",e="unknown"),console.error(`❌ Webhook test failed with ${e} error:`,d),console.error(`❌ Full error details:`,f),await g.db.update(h.webhooks).set({totalDeliveries:(c.totalDeliveries||0)+1,failedDeliveries:(c.failedDeliveries||0)+1,updatedAt:new Date}).where((0,i.eq)(h.webhooks.id,a)),(0,k.revalidatePath)("/webhooks"),{success:!1,error:`Webhook test failed: ${d}`,responseTime:b,details:{url:c.url,timeout:c.timeout||30,errorType:e,originalError:f.message}}}}catch(a){return console.error("Error testing webhook:",a),{error:"Failed to test webhook"}}}(0,a.i(377991).ensureServerEntryExports)([l,m,n,o,p,q]),(0,d.registerServerReference)(l,"0033509ad366aa6a87e952e2313e6ac9178e219542",null),(0,d.registerServerReference)(m,"4081346da158b674d90d1c417b04619a1133847eed",null),(0,d.registerServerReference)(n,"40ac5c1f5a73f51e037883eba8504686a1e492c7ab",null),(0,d.registerServerReference)(o,"6059f1634f6dfc74054b84ae414c11596cceeb4c6e",null),(0,d.registerServerReference)(p,"40678defcdd6d1be0653983f7df2baf1cbbfbc5edc",null),(0,d.registerServerReference)(q,"400605f8cc72befca4c1d670ad479a8708cca3a3e0",null)},113369:a=>{"use strict";var{g:b,__dirname:c,a:d}=a;d(async(b,c)=>{try{a.s({}),a.i(498718);var d=a.i(253685);a.i(255593),a.i(785366);var e=b([d]);[d]=e.then?(await e)():e,c()}catch(a){c(a)}},!1)},252764:a=>{"use strict";var{g:b,__dirname:c,a:d}=a;d(async(b,c)=>{try{a.s({}),a.i(498718);var d=a.i(253685);a.i(255593),a.i(785366);var e=a.i(113369),f=b([d,e]);[d,e]=f.then?(await f)():f,c()}catch(a){c(a)}},!1)},105412:a=>{"use strict";var{g:b,__dirname:c,a:d}=a;d(async(b,c)=>{try{a.s({"00282b3a5eacbbc918f95ec4473b7dc09d0e5ffcf8":()=>d.generateAutumnBillingPortal,"0033509ad366aa6a87e952e2313e6ac9178e219542":()=>g.getWebhooks,"00bd5c39d59f2c9e83dce14d93d44f40e9d2c4f1ae":()=>d.getAutumnCustomer,"00faa09f01a5256e987f59d5eb3348cc00f9bf9491":()=>d.getDomainStats,"4001b46509619c2e0fe09e06802ee8157c6226ec8c":()=>e.sendFeedbackAction,"400605f8cc72befca4c1d670ad479a8708cca3a3e0":()=>g.testWebhook,"40678defcdd6d1be0653983f7df2baf1cbbfbc5edc":()=>g.deleteWebhook,"40ac5c1f5a73f51e037883eba8504686a1e492c7ab":()=>g.createWebhook,"40d22d6e027abaab42994fd38d69f454c777a42914":()=>f.getOnboardingStatus,"6059f1634f6dfc74054b84ae414c11596cceeb4c6e":()=>g.updateWebhook});var d=a.i(498718),e=a.i(253685),f=a.i(255593),g=a.i(785366),h=a.i(113369),i=b([e,h]);[e,h]=i.then?(await i)():i,c()}catch(a){c(a)}},!1)},619263:a=>{"use strict";var{g:b,__dirname:c,a:d}=a;d(async(b,c)=>{try{a.s({"00282b3a5eacbbc918f95ec4473b7dc09d0e5ffcf8":()=>e["00282b3a5eacbbc918f95ec4473b7dc09d0e5ffcf8"],"0033509ad366aa6a87e952e2313e6ac9178e219542":()=>e["0033509ad366aa6a87e952e2313e6ac9178e219542"],"00bd5c39d59f2c9e83dce14d93d44f40e9d2c4f1ae":()=>e["00bd5c39d59f2c9e83dce14d93d44f40e9d2c4f1ae"],"00faa09f01a5256e987f59d5eb3348cc00f9bf9491":()=>e["00faa09f01a5256e987f59d5eb3348cc00f9bf9491"],"4001b46509619c2e0fe09e06802ee8157c6226ec8c":()=>e["4001b46509619c2e0fe09e06802ee8157c6226ec8c"],"400605f8cc72befca4c1d670ad479a8708cca3a3e0":()=>e["400605f8cc72befca4c1d670ad479a8708cca3a3e0"],"40678defcdd6d1be0653983f7df2baf1cbbfbc5edc":()=>e["40678defcdd6d1be0653983f7df2baf1cbbfbc5edc"],"40ac5c1f5a73f51e037883eba8504686a1e492c7ab":()=>e["40ac5c1f5a73f51e037883eba8504686a1e492c7ab"],"40d22d6e027abaab42994fd38d69f454c777a42914":()=>e["40d22d6e027abaab42994fd38d69f454c777a42914"],"6059f1634f6dfc74054b84ae414c11596cceeb4c6e":()=>e["6059f1634f6dfc74054b84ae414c11596cceeb4c6e"]});var d=a.i(252764),e=a.i(105412),f=b([d,e]);[d,e]=f.then?(await f)():f,c()}catch(a){c(a)}},!1)}};

//# sourceMappingURL=_5fa08010._.js.map