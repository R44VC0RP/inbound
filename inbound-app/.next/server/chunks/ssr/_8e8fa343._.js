module.exports={650572:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({default:()=>b});var d=a.i(674420);let b=function({fill:a="currentColor",secondaryfill:b,title:c="badge 13",...e}){return b=b||a,(0,d.jsxs)("svg",{height:"18",width:"18",...e,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[(0,d.jsx)("title",{children:c}),(0,d.jsxs)("g",{fill:a,children:[(0,d.jsx)("path",{d:"M13.75,2.5h-1.5c-.414,0-.75,.336-.75,.75s.336,.75,.75,.75h1.5c.689,0,1.25,.561,1.25,1.25v7.5c0,.689-.561,1.25-1.25,1.25H4.25c-.689,0-1.25-.561-1.25-1.25V5.25c0-.689,.561-1.25,1.25-1.25h1.5c.414,0,.75-.336,.75-.75s-.336-.75-.75-.75h-1.5c-1.517,0-2.75,1.233-2.75,2.75v7.5c0,1.517,1.233,2.75,2.75,2.75H13.75c1.517,0,2.75-1.233,2.75-2.75V5.25c0-1.517-1.233-2.75-2.75-2.75Z",fill:a}),(0,d.jsx)("path",{d:"M5.47,8.22c-.293,.293-.293,.768,0,1.061l3,3c.146,.146,.338,.22,.53,.22s.384-.073,.53-.22l3-3c.293-.293,.293-.768,0-1.061s-.768-.293-1.061,0l-1.72,1.72V3.25c0-.414-.336-.75-.75-.75s-.75,.336-.75,.75v6.689l-1.72-1.72c-.293-.293-.768-.293-1.061,0Z",fill:b})]})]})}}},336266:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({downloadAttachment:()=>e});var d=a.i(283620),e=(0,d.createServerReference)("6021894a83b2e73334806bae731dbe3ae3e2d52354",d.callServer,void 0,d.findSourceMapURL,"downloadAttachment")},791099:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({EmailAttachments:()=>k});var d=a.i(674420),e=a.i(378903),f=a.i(525164),g=a.i(650572),h=a.i(336266),i=a.i(566825);async function j(a,b){try{let c=await (0,h.downloadAttachment)(a,b);if(!c.success||!c.data){console.error("Failed to download attachment:",c.error),c.error?.includes("content not available")?alert("This attachment cannot be downloaded because the email was processed without full binary data storage. This typically happens with older emails or emails processed during system maintenance."):alert(`Failed to download attachment: ${c.error}`);return}let d=atob(c.data.content),e=new Uint8Array(d.length);for(let a=0;a<d.length;a++)e[a]=d.charCodeAt(a);let f=new Blob([e],{type:c.data.contentType}),g=URL.createObjectURL(f),i=document.createElement("a");i.href=g,i.download=c.data.filename,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(g)}catch(a){console.error("Error downloading attachment:",a),alert("An unexpected error occurred while downloading the attachment.")}}function k({emailId:a,attachments:b}){if(!b||0===b.length)return null;let c=b.filter(a=>a.filename);return 0===c.length?null:(0,d.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:[c.length," Attachment",c.length>1?"s":""]}),(0,d.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:c.map((b,c)=>(0,d.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,d.jsx)(i.CustomInboundIcon,{Icon:f.default,backgroundColor:"#6b7280",size:32,className:"flex-shrink-0"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("div",{className:"font-medium text-sm text-gray-900 truncate",children:b.filename}),(0,d.jsxs)("div",{className:"text-xs text-gray-500",children:[b.contentType||"Unknown type"," • ",function(a){if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(2))+" "+["Bytes","KB","MB","GB"][b]}(b.size||0)]})]}),(0,d.jsx)(e.Button,{variant:"ghost",size:"sm",className:"text-gray-600 hover:bg-gray-100",onClick:()=>j(a,b.filename),disabled:!b.filename,children:(0,d.jsx)(g.default,{className:"h-4 w-4"})})]},c))})]})}},932990:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({extractNewContent:()=>g,getQuoteLevels:()=>i,hasQuotedContent:()=>h,parseEmailContent:()=>f,parseHtmlEmailContent:()=>e,parseTextEmailContent:()=>d,splitIntoMessages:()=>j});let b=[/^On .+, .+ wrote:$/m,/^Am .+ schrieb .+:$/m,/^Le .+ .+ a écrit :$/m,/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}.*wrote:/m,/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}.*wrote:/m,/^From: .+$/m,/^To: .+$/m,/^Subject: .+$/m,/^Date: .+$/m,/^----- ?Original Message ?-----/m,/^----- ?Forwarded [Mm]essage ?-----/m,/^Begin forwarded message:/m,/^---------- Forwarded message ----------/m,/^> /m,/^>\s*$/m,/^-----+/m,/^_{3,}/m,/^={3,}/m,/^Sent from my /m,/^Get Outlook for /m],c=[/On .+, .+ wrote:/,/Am .+ schrieb .+:/,/Le .+ .+ a écrit :/,/\d{4}-\d{2}-\d{2} \d{2}:\d{2}.*wrote:/,/\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}.*wrote:/,/----- ?Original Message ?-----/,/----- ?Forwarded [Mm]essage ?-----/,/Begin forwarded message:/,/---------- Forwarded message ----------/];function d(a){if(!a||"string"!=typeof a)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let d=a.split("\n"),e=[],f=[],g=!1,h=0;for(let a=0;a<d.length;a++){let i=d[a],j=i.trim();if(g)f.push(i),i.startsWith(">")&&(h=Math.max(h,i.match(/^>+/)?.[0]?.length||0));else{let k=c.some(a=>a.test(i)),l=i.startsWith(">")||""===j&&d[a+1]?.startsWith(">"),m=b.some(a=>a.test(i));k||l||m?(g=!0,f.push(i),i.startsWith(">")&&(h=Math.max(h,i.match(/^>+/)?.[0]?.length||0))):e.push(i)}}for(;e.length>0&&""===e[e.length-1].trim();)e.pop();let i=e.join("\n").trim(),j=f.join("\n").trim();return{newContent:i,quotedContent:j,hasQuotedContent:j.length>0,quoteLevels:h}}function e(a){if(!a||"string"!=typeof a)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let b=-1,c=0;for(let d of[/<div[^>]*class="[^"]*gmail_quote[^"]*"[^>]*>/i,/<blockquote[^>]*class="[^"]*gmail_quote[^"]*"[^>]*>/i,/<blockquote[^>]*>/i,/<div[^>]*style="[^"]*border-left[^"]*"[^>]*>/i,/<div[^>]*style="[^"]*margin-left[^"]*"[^>]*>/i,/<div[^>]*style="[^"]*border-top[^"]*"[^>]*>/i,/<div[^>]*class="[^"]*quote[^"]*"[^>]*>/i,/<div[^>]*class="[^"]*moz-cite-prefix[^"]*"[^>]*>/i]){let e=a.match(d);e&&void 0!==e.index&&(-1===b||e.index<b)&&(b=e.index,c=1)}for(let d of[/On .+, .+ wrote:/,/From: .+/,/----- ?Original Message ?-----/,/----- ?Forwarded [Mm]essage ?-----/,/Begin forwarded message:/,/---------- Forwarded message ----------/,/Sent from my /,/Get Outlook for /]){let e=a.match(d);e&&void 0!==e.index&&(-1===b||e.index<b)&&(b=e.index,c=1)}if(-1!==b){let d=a.substring(b).match(/<blockquote[^>]*>/gi);d&&(c=Math.max(c,d.length))}if(-1!==b){let d=a.substring(0,b).trim(),e=a.substring(b).trim();return{newContent:d,quotedContent:e,hasQuotedContent:e.length>0,quoteLevels:c}}return{newContent:a.trim(),quotedContent:"",hasQuotedContent:!1,quoteLevels:0}}function f(a){if(!a)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let b=/<[^>]+>/g.test(a),c=/&[a-zA-Z0-9#]+;/g.test(a);return b||c?e(a):d(a)}function g(a){return f(a).newContent}function h(a){return f(a).hasQuotedContent}function i(a){return f(a).quoteLevels}function j(a){let b;if(!a)return[];let d=[],e=a.split("\n"),f=[];for(let a=0;a<e.length;a++){let g=e[a],h=c.some(a=>a.test(g));h&&f.length>0?(d.push({content:f.join("\n").trim(),attribution:b,isForwarded:/forward|fwd/i.test(b||"")}),f=[],b=g.trim()):h?b=g.trim():f.push(g)}return f.length>0&&d.push({content:f.join("\n").trim(),attribution:b,isForwarded:/forward|fwd/i.test(b||"")}),d.filter(a=>a.content.length>0)}}},652247:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({default:()=>z});var d=a.i(674420),e=a.i(918656),f=a.i(714513),g=a.i(722851),h=a.i(123546),i=a.i(238769),j=a.i(378903),k=a.i(487085),l=a.i(386483),m=a.i(816486),n=a.i(693610),o=a.i(569164),p=a.i(195743),q=a.i(919801),r=a.i(499815),s=a.i(566825),t=a.i(791099);a.i(697859);var u=a.i(458146),v=a.i(790024),w=a.i(323772),x=a.i(932990);function y({message:a,isLatest:b=!1,showAttachments:c=!0}){let e=a.fromName||a.from.split("<")[0].trim()||a.from.split("@")[0],f=(a=>{let b=a.trim().split(/\s+/);return b.length>=2?(b[0].charAt(0)+b[1].charAt(0)).toUpperCase():a.slice(0,2).toUpperCase()})(e),g=(a=>{let b=["#6366f1","#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#ec4899","#84cc16"];return b[Math.abs(a.split("").reduce((a,b)=>(a=(a<<5)-a+b.charCodeAt(0))&a,0))%b.length]})(e),h=a.receivedAt||a.sentAt,j=a.content.htmlBody?(0,x.extractNewContent)(a.content.htmlBody)||a.content.htmlBody:(0,x.extractNewContent)(a.content.textBody||"")||a.content.textBody;return(0,d.jsxs)("div",{className:`border-l-2 pl-4 pb-6 ${"outbound"===a.type?"border-l-blue-200 bg-blue-50/30":"border-l-gray-200"}`,children:[(0,d.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,d.jsx)(s.CustomInboundIcon,{text:f,size:32,backgroundColor:g}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"font-medium text-foreground text-sm",children:e}),(0,d.jsxs)("span",{className:"text-muted-foreground text-xs",children:["<",a.addresses.from?.addresses?.[0]?.address||a.from,">"]}),"outbound"===a.type&&(0,d.jsx)(i.Badge,{className:"bg-blue-500 text-white rounded-full px-2 py-0.5 text-xs",children:"Sent"})]}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:h?(0,r.format)(new Date(h),"MMM d, h:mm a"):"Unknown date"})]}),(0,d.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["to ",a.to]})]})]}),(0,d.jsxs)("div",{className:"ml-8",children:[j?a.content.htmlBody?(0,d.jsx)("div",{className:"prose prose-sm max-w-none rounded-lg",style:{fontFamily:"Inter, system-ui, sans-serif",textAlign:"left"},dangerouslySetInnerHTML:{__html:j}}):(0,d.jsx)("div",{className:"whitespace-pre-wrap text-foreground leading-relaxed text-sm",style:{fontFamily:"Inter, system-ui, sans-serif",textAlign:"left"},children:j}):(0,d.jsxs)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:[(0,d.jsx)(o.default,{className:"h-4 w-4 mx-auto mb-1"}),(0,d.jsx)("p",{children:"No content available"})]}),c&&a.content.attachments&&a.content.attachments.length>0&&(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(t.EmailAttachments,{emailId:a.id,attachments:a.content.attachments})})]})]})}function z(){let a=(0,e.useParams)(),b=(0,e.useRouter)(),{data:c}=(0,f.useSession)(),r=a.id,[s,t]=(0,g.useState)(""),[x,z]=(0,g.useState)(""),[A,B]=(0,g.useState)(!1),[C,D]=(0,g.useState)(""),{data:E,isLoading:F,error:G,refetch:H}=(0,u.useEmailThreadV2Query)(r),I=(0,u.useMarkEmailAsReadV2Mutation)(),J=(0,u.useReplyToEmailV2Mutation)(),{data:K}=(0,v.useDomainsListV2Query)({status:"verified"});(0,g.useEffect)(()=>{c||b.push("/login")},[c,b]),(0,g.useEffect)(()=>{if(E?.messages){let a=E.messages.find(a=>a.id===r);a&&!a.isRead&&"inbound"===a.type&&I.mutate(r)}},[E,r,I]),(0,g.useEffect)(()=>{if(E?.messages&&!x&&!A){let a=E.messages.filter(a=>"inbound"===a.type).sort((a,b)=>new Date(b.receivedAt||0).getTime()-new Date(a.receivedAt||0).getTime())[0];a&&z(a.addresses.to?.addresses?.[0]?.address||a.to)}},[E,x,A]);let L=()=>{if(!C||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C))return!1;let a=C.split("@")[1];return(K?.data?.filter(a=>"verified"===a.status)||[]).some(b=>b.domain===a)},M=async()=>{if(!s.trim())return void w.toast.error("Please enter a reply message");let a=A&&C?C:x;if(!a)return void w.toast.error("Please select a from address");if(A&&!L())return void w.toast.error("Invalid email address or domain not verified");let b=E?.messages?.filter(a=>"inbound"===a.type)?.sort((a,b)=>new Date(b.receivedAt||0).getTime()-new Date(a.receivedAt||0).getTime())[0],c=b?.addresses.from?.addresses?.[0]?.address||(b?.from.includes("<")?b.from.split("<")[1].replace(">",""):b?.from);try{await J.mutateAsync({emailId:r,from:a,to:c,text:s,include_original:!0}),w.toast.success("Reply sent successfully!"),t(""),D(""),B(!1),H()}catch(a){console.error("Failed to send reply:",a),w.toast.error(a instanceof Error?a.message:"Failed to send reply")}};if(F)return(0,d.jsx)("div",{className:"p-4 font-outfit",children:(0,d.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,d.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,d.jsx)("div",{className:"text-muted-foreground",children:"Loading conversation..."})})})});if(G||!E)return(0,d.jsx)("div",{className:"p-4 font-outfit",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,d.jsx)(m.default,{href:"/mail",children:(0,d.jsxs)(j.Button,{variant:"primary",children:[(0,d.jsx)(n.default,{className:"h-4 w-4 mr-2"}),"Back to Mail"]})})}),(0,d.jsx)(h.Card,{className:"border-destructive/50 bg-destructive/10 rounded-xl",children:(0,d.jsx)(h.CardContent,{className:"p-6",children:(0,d.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,d.jsx)(o.default,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:G?.message||"Failed to load conversation"})]})})})]})});let N=E.messages[0]?.subject||"No Subject",O=E.messages.length;return(0,d.jsx)("div",{className:"p-4 font-outfit",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,d.jsx)(m.default,{href:"/mail",children:(0,d.jsxs)(j.Button,{variant:"primary",children:[(0,d.jsx)(n.default,{className:"h-4 w-4 mr-2"}),"Back to Mail"]})})}),(0,d.jsx)(h.Card,{className:"rounded-xl overflow-hidden mb-4",children:(0,d.jsx)(h.CardContent,{className:"p-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-semibold text-foreground mb-2 tracking-tight",children:N}),(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:[O," message",1!==O?"s":""," in conversation"]})]}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsxs)(i.Badge,{className:"bg-blue-500 text-white rounded-full px-2.5 py-0.5 text-xs font-medium",children:[(0,d.jsx)(o.default,{className:"w-3 h-3 mr-1"}),"Thread"]})})]})})}),(0,d.jsx)(h.Card,{className:"rounded-xl overflow-hidden",children:(0,d.jsx)(h.CardContent,{className:"p-6",children:(0,d.jsx)("div",{className:"space-y-0",children:E.messages.map((a,b)=>(0,d.jsx)(y,{message:a,isLatest:b===E.messages.length-1,showAttachments:b===E.messages.length-1},a.id))})})}),(0,d.jsx)(h.Card,{className:"rounded-xl overflow-hidden mt-4",children:(0,d.jsx)(h.CardContent,{className:"p-6",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Reply"}),(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:["From: ",A&&C?C:x]})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(k.Textarea,{value:s,onChange:a=>t(a.target.value),placeholder:"Type your reply here...",rows:6,className:"w-full resize-none pr-16",disabled:J.isPending}),(0,d.jsx)(j.Button,{onClick:M,disabled:J.isPending||!s.trim()||!A&&!x||A&&(!C||!L()),size:"icon",className:"absolute bottom-2 right-2",title:"Send Reply",children:J.isPending?(0,d.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,d.jsx)(q.default,{className:"h-4 w-4"})})]}),(0,d.jsx)("div",{className:"pt-2 border-t border-border",children:(0,d.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>B(!A),className:"text-xs text-muted-foreground hover:text-foreground",children:[A?"Hide":"Show"," Advanced Options"]})}),A&&(0,d.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(l.Label,{htmlFor:"custom-from",children:"Custom From Address"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"email",id:"custom-from",value:C,onChange:a=>D(a.target.value),placeholder:"custom@yourdomain.com",className:"flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"}),(0,d.jsx)("div",{className:"flex items-center justify-center w-8 h-8",children:C&&(L()?(0,d.jsx)(p.default,{className:"h-5 w-5 text-green-500"}):(0,d.jsx)("span",{className:"text-red-500",children:"❌"}))})]}),C&&!L()&&(0,d.jsxs)("p",{className:"text-xs text-red-500",children:["Email address must use one of your verified domains: ",K?.data?.filter(a=>"verified"===a.status).map(a=>a.domain).join(", ")]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Your Verified Domains"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-2",children:K?.data?.filter(a=>"verified"===a.status).map(a=>(0,d.jsxs)(i.Badge,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80",onClick:()=>{let b=C.split("@")[0]||"noreply";D(`${b}@${a.domain}`)},children:["@",a.domain]},a.id))})]})]}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your reply will be added to this conversation thread."})]})})})]})})}}};

//# sourceMappingURL=_8e8fa343._.js.map