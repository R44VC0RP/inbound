module.exports={929549:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>i.DELIVERY_STATUS,DELIVERY_TYPES:()=>i.DELIVERY_TYPES,DOMAIN_STATUS:()=>i.DOMAIN_STATUS,EMAIL_STATUS:()=>i.EMAIL_STATUS,ENDPOINT_TYPES:()=>i.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>i.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>i.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>i.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>i.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>i.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>i.WEBHOOK_STATUS,account:()=>t.account,apikey:()=>t.apikey,blockedEmails:()=>i.blockedEmails,domainDnsRecords:()=>i.domainDnsRecords,emailAddresses:()=>i.emailAddresses,emailDomains:()=>i.emailDomains,emailGroups:()=>i.emailGroups,endpointDeliveries:()=>i.endpointDeliveries,endpoints:()=>i.endpoints,parsedEmails:()=>i.parsedEmails,receivedEmails:()=>i.receivedEmails,sentEmails:()=>i.sentEmails,sesEvents:()=>i.sesEvents,session:()=>t.session,structuredEmails:()=>i.structuredEmails,subscriptions:()=>i.subscriptions,user:()=>t.user,userAccounts:()=>i.userAccounts,userOnboarding:()=>i.userOnboarding,verification:()=>t.verification,vipAllowedSenders:()=>i.vipAllowedSenders,vipConfigs:()=>i.vipConfigs,vipEmailAttempts:()=>i.vipEmailAttempts,vipPaymentSessions:()=>i.vipPaymentSessions,webhookDeliveries:()=>i.webhookDeliveries,webhooks:()=>i.webhooks});var t=e.i(594120),i=e.i(55379)},436754:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>t.DELIVERY_STATUS,DELIVERY_TYPES:()=>t.DELIVERY_TYPES,DOMAIN_STATUS:()=>t.DOMAIN_STATUS,EMAIL_STATUS:()=>t.EMAIL_STATUS,ENDPOINT_TYPES:()=>t.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>t.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>t.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>t.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>t.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>t.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>t.WEBHOOK_STATUS,account:()=>t.account,apikey:()=>t.apikey,blockedEmails:()=>t.blockedEmails,domainDnsRecords:()=>t.domainDnsRecords,emailAddresses:()=>t.emailAddresses,emailDomains:()=>t.emailDomains,emailGroups:()=>t.emailGroups,endpointDeliveries:()=>t.endpointDeliveries,endpoints:()=>t.endpoints,parsedEmails:()=>t.parsedEmails,receivedEmails:()=>t.receivedEmails,sentEmails:()=>t.sentEmails,sesEvents:()=>t.sesEvents,session:()=>t.session,structuredEmails:()=>t.structuredEmails,subscriptions:()=>t.subscriptions,user:()=>t.user,userAccounts:()=>t.userAccounts,userOnboarding:()=>t.userOnboarding,verification:()=>t.verification,vipAllowedSenders:()=>t.vipAllowedSenders,vipConfigs:()=>t.vipConfigs,vipEmailAttempts:()=>t.vipEmailAttempts,vipPaymentSessions:()=>t.vipPaymentSessions,webhookDeliveries:()=>t.webhookDeliveries,webhooks:()=>t.webhooks}),e.i(468686);var t=e.i(909834)},496669:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({createApiKeyMiddleware:()=>n,validateApiKey:()=>i});var t=e.i(402168);async function i(e){try{let r,s=e.headers.get("Authorization");if(!s)return{valid:!1,error:"Missing Authorization header"};if(r=s.startsWith("Bearer ")?s.substring(7):s,console.log("API KEY: "+r),!r)return{valid:!1,error:"Invalid Authorization header format"};let{valid:i,error:n,key:o}=await t.auth.api.verifyApiKey({body:{key:r}});if(console.log("VALID: "+i),console.log("ERROR: "+n),console.log("KEY: "+o?.userId),!i||n||!o)return{valid:!1,error:n?.message||"Invalid API key"};if(!o.enabled)return{valid:!1,error:"API key is disabled"};if(o.expiresAt&&new Date(o.expiresAt)<new Date)return{valid:!1,error:"API key has expired"};return{valid:!0,user:{id:o.userId,email:o.userId,name:null}}}catch(e){return console.error("API key validation error:",e),{valid:!1,error:"Internal server error during API key validation"}}}function n(){return async e=>{let r=await i(e);return r.valid?{user:r.user}:{error:r.error,status:401}}}},869050:function(e){var{g:r,__dirname:s,m:t,e:i}=e},193300:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({DELETE:()=>m,GET:()=>u,PUT:()=>c});var t=e.i(125427),i=e.i(496669),n=e.i(557440);e.i(468686);var o=e.i(55379),a=e.i(176825),d=e.i(460009),l=e.i(91890),p=e.i(318812);async function u(e,{params:r}){try{console.log(`üìã GET /api/v1.1/endpoints/${r.id} - Fetching endpoint details`);let s=await (0,i.validateApiKey)(e);if("error"in s)return t.NextResponse.json({error:s.error},{status:401});let p=s.user?.id;if(!p)return t.NextResponse.json({error:"User not found"},{status:401});let u=await n.db.select().from(o.endpoints).where((0,a.and)((0,a.eq)(o.endpoints.id,r.id),(0,a.eq)(o.endpoints.userId,p))).limit(1);if(!u[0])return t.NextResponse.json({success:!1,error:"Endpoint not found"},{status:404});let c=u[0],m=null;"email_group"===c.type&&(m=(await n.db.select({emailAddress:o.emailGroups.emailAddress}).from(o.emailGroups).where((0,a.eq)(o.emailGroups.endpointId,c.id)).orderBy(o.emailGroups.createdAt)).map(e=>e.emailAddress));let v=await n.db.select({total:(0,l.count)(),status:o.endpointDeliveries.status}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,c.id)).groupBy(o.endpointDeliveries.status),E=0,A=0,f=0;for(let e of v)E+=e.total,"success"===e.status&&(A+=e.total),"failed"===e.status&&(f+=e.total);let g=await n.db.select({id:o.endpointDeliveries.id,emailId:o.endpointDeliveries.emailId,deliveryType:o.endpointDeliveries.deliveryType,status:o.endpointDeliveries.status,attempts:o.endpointDeliveries.attempts,lastAttemptAt:o.endpointDeliveries.lastAttemptAt,responseData:o.endpointDeliveries.responseData,createdAt:o.endpointDeliveries.createdAt}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,c.id)).orderBy((0,d.desc)(o.endpointDeliveries.createdAt)).limit(10),T=await n.db.select({id:o.emailAddresses.id,address:o.emailAddresses.address,isActive:o.emailAddresses.isActive,createdAt:o.emailAddresses.createdAt}).from(o.emailAddresses).where((0,a.eq)(o.emailAddresses.endpointId,c.id)).orderBy(o.emailAddresses.createdAt),S=await n.db.select({id:o.emailDomains.id,domain:o.emailDomains.domain,status:o.emailDomains.status}).from(o.emailDomains).where((0,a.eq)(o.emailDomains.catchAllEndpointId,c.id)),h={...c,config:JSON.parse(c.config),groupEmails:m,deliveryStats:{total:E,successful:A,failed:f,successRate:E>0?Math.round(A/E*100):0},recentDeliveries:g.map(e=>({...e,responseData:e.responseData?JSON.parse(e.responseData):null})),associatedEmails:T,catchAllDomains:S,usage:{emailAddressCount:T.length,catchAllDomainCount:S.length,totalEmailsProcessed:E}};return console.log(`‚úÖ GET /api/v1.1/endpoints/${r.id} - Retrieved endpoint details`),t.NextResponse.json({success:!0,data:h})}catch(e){return console.error(`‚ùå GET /api/v1.1/endpoints/${r.id} - Error:`,e),t.NextResponse.json({success:!1,error:"Failed to fetch endpoint details",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(e,{params:r}){try{console.log(`üìù PUT /api/v1.1/endpoints/${r.id} - Updating endpoint`);let s=await (0,i.validateApiKey)(e);if("error"in s)return t.NextResponse.json({error:s.error},{status:401});let d=s.user?.id;if(!d)return t.NextResponse.json({error:"User not found"},{status:401});let l=await e.json(),u=await n.db.select().from(o.endpoints).where((0,a.and)((0,a.eq)(o.endpoints.id,r.id),(0,a.eq)(o.endpoints.userId,d))).limit(1);if(!u[0])return t.NextResponse.json({success:!1,error:"Endpoint not found"},{status:404});if(l.config){let e=function(e,r){try{switch(e){case"webhook":if(!r.url)return{valid:!1,error:"Webhook URL is required"};if("string"!=typeof r.url)return{valid:!1,error:"Webhook URL must be a string"};try{new URL(r.url)}catch{return{valid:!1,error:"Invalid webhook URL format"}}if(r.timeout&&("number"!=typeof r.timeout||r.timeout<1||r.timeout>300))return{valid:!1,error:"Timeout must be a number between 1 and 300 seconds"};if(r.retryAttempts&&("number"!=typeof r.retryAttempts||r.retryAttempts<0||r.retryAttempts>10))return{valid:!1,error:"Retry attempts must be a number between 0 and 10"};break;case"email":if(!r.forwardTo)return{valid:!1,error:"Forward-to email address is required"};if("string"!=typeof r.forwardTo)return{valid:!1,error:"Forward-to email must be a string"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.forwardTo))return{valid:!1,error:"Invalid forward-to email address format"};break;case"email_group":if(!r.emails||!Array.isArray(r.emails))return{valid:!1,error:"Email group must have an emails array"};if(0===r.emails.length)return{valid:!1,error:"Email group must have at least one email address"};if(r.emails.length>50)return{valid:!1,error:"Email group cannot have more than 50 email addresses"};let s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let e of r.emails)if("string"!=typeof e||!s.test(e))return{valid:!1,error:`Invalid email address in group: ${e}`};if(new Set(r.emails).size!==r.emails.length)return{valid:!1,error:"Email group contains duplicate email addresses"};break;default:return{valid:!1,error:"Unknown endpoint type"}}return{valid:!0}}catch(e){return{valid:!1,error:"Configuration validation failed"}}}(u[0].type,l.config);if(!e.valid)return t.NextResponse.json({success:!1,error:"Invalid configuration",details:e.error},{status:400})}let c={updatedAt:new Date};void 0!==l.name&&(c.name=l.name),void 0!==l.description&&(c.description=l.description),void 0!==l.isActive&&(c.isActive=l.isActive),void 0!==l.config&&(c.config=JSON.stringify(l.config));let[m]=await n.db.update(o.endpoints).set(c).where((0,a.eq)(o.endpoints.id,r.id)).returning();if(l.config&&"email_group"===u[0].type&&"emails"in l.config){await n.db.delete(o.emailGroups).where((0,a.eq)(o.emailGroups.endpointId,r.id));let e=l.config.emails.map(e=>({id:(0,p.nanoid)(),endpointId:r.id,emailAddress:e,createdAt:new Date}));e.length>0&&(await n.db.insert(o.emailGroups).values(e),console.log(`üìÆ PUT /api/v1.1/endpoints/${r.id} - Updated ${e.length} email group entries`))}let v={...m,config:JSON.parse(m.config),groupEmails:"email_group"===u[0].type&&l.config&&"emails"in l.config?l.config.emails:null};return console.log(`‚úÖ PUT /api/v1.1/endpoints/${r.id} - Successfully updated endpoint`),t.NextResponse.json({success:!0,data:v,message:"Endpoint updated successfully"})}catch(e){return console.error(`‚ùå PUT /api/v1.1/endpoints/${r.id} - Error:`,e),t.NextResponse.json({success:!1,error:"Failed to update endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function m(e,{params:r}){try{console.log(`üóëÔ∏è DELETE /api/v1.1/endpoints/${r.id} - Deleting endpoint`);let s=await (0,i.validateApiKey)(e);if("error"in s)return t.NextResponse.json({error:s.error},{status:401});let d=s.user?.id;if(!d)return t.NextResponse.json({error:"User not found"},{status:401});let l=await n.db.select().from(o.endpoints).where((0,a.and)((0,a.eq)(o.endpoints.id,r.id),(0,a.eq)(o.endpoints.userId,d))).limit(1);if(!l[0])return t.NextResponse.json({success:!1,error:"Endpoint not found"},{status:404});let p=await n.db.update(o.emailAddresses).set({endpointId:null,updatedAt:new Date}).where((0,a.eq)(o.emailAddresses.endpointId,r.id)).returning({address:o.emailAddresses.address});return p.length>0&&console.log(`üìß DELETE /api/v1.1/endpoints/${r.id} - Updated ${p.length} email addresses to store-only mode:`,p.map(e=>e.address).join(", ")),await n.db.update(o.emailDomains).set({catchAllEndpointId:null,updatedAt:new Date}).where((0,a.eq)(o.emailDomains.catchAllEndpointId,r.id)),"email_group"===l[0].type&&(await n.db.delete(o.emailGroups).where((0,a.eq)(o.emailGroups.endpointId,r.id)),console.log(`üìÆ DELETE /api/v1.1/endpoints/${r.id} - Deleted email group entries`)),await n.db.delete(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,r.id)),console.log(`üìä DELETE /api/v1.1/endpoints/${r.id} - Deleted delivery history`),await n.db.delete(o.endpoints).where((0,a.eq)(o.endpoints.id,r.id)),console.log(`‚úÖ DELETE /api/v1.1/endpoints/${r.id} - Successfully deleted endpoint`),t.NextResponse.json({success:!0,message:p.length>0?`Endpoint deleted successfully. ${p.length} email address(es) switched to store-only mode.`:"Endpoint deleted successfully",emailAddressesUpdated:p.length,updatedEmailAddresses:p.map(e=>e.address)})}catch(e){return console.error(`‚ùå DELETE /api/v1.1/endpoints/${r.id} - Error:`,e),t.NextResponse.json({success:!1,error:"Failed to delete endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}},465587:e=>{"use strict";var{g:r,__dirname:s}=e;{e.s({patchFetch:()=>a,routeModule:()=>r,serverHooks:()=>l,workAsyncStorage:()=>s,workUnitAsyncStorage:()=>d});var t=e.i(854885),i=e.i(814689),n=e.i(25402),o=e.i(193300);let r=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/v1.1/endpoints/[id]/route",pathname:"/api/v1.1/endpoints/[id]",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v1.1/endpoints/[id]/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:s,workUnitAsyncStorage:d,serverHooks:l}=r;function a(){return(0,n.patchFetch)({workAsyncStorage:s,workUnitAsyncStorage:d})}}},993477:e=>{var{g:r,__dirname:s}=e;e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__89369233._.js","server/chunks/node_modules_10ae7a2d._.js"].map(r=>e.l(r))).then(()=>r(611487)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__02d9b42c._.js.map