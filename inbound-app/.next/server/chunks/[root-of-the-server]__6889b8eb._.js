module.exports={929549:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:s,__dirname:i,m:r,e:t}=e;r.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({DELIVERY_STATUS:()=>t.DELIVERY_STATUS,DELIVERY_TYPES:()=>t.DELIVERY_TYPES,DOMAIN_STATUS:()=>t.DOMAIN_STATUS,EMAIL_STATUS:()=>t.EMAIL_STATUS,ENDPOINT_TYPES:()=>t.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>t.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>t.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>t.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>t.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>t.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>t.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>t.blockedEmails,domainDnsRecords:()=>t.domainDnsRecords,emailAddresses:()=>t.emailAddresses,emailDomains:()=>t.emailDomains,emailGroups:()=>t.emailGroups,endpointDeliveries:()=>t.endpointDeliveries,endpoints:()=>t.endpoints,parsedEmails:()=>t.parsedEmails,receivedEmails:()=>t.receivedEmails,sentEmails:()=>t.sentEmails,sesEvents:()=>t.sesEvents,session:()=>r.session,structuredEmails:()=>t.structuredEmails,subscriptions:()=>t.subscriptions,user:()=>r.user,userAccounts:()=>t.userAccounts,userOnboarding:()=>t.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>t.vipAllowedSenders,vipConfigs:()=>t.vipConfigs,vipEmailAttempts:()=>t.vipEmailAttempts,vipPaymentSessions:()=>t.vipPaymentSessions,webhookDeliveries:()=>t.webhookDeliveries,webhooks:()=>t.webhooks});var r=e.i(594120),t=e.i(55379)},436754:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({DELIVERY_STATUS:()=>r.DELIVERY_STATUS,DELIVERY_TYPES:()=>r.DELIVERY_TYPES,DOMAIN_STATUS:()=>r.DOMAIN_STATUS,EMAIL_STATUS:()=>r.EMAIL_STATUS,ENDPOINT_TYPES:()=>r.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>r.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>r.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>r.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>r.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>r.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>r.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>r.blockedEmails,domainDnsRecords:()=>r.domainDnsRecords,emailAddresses:()=>r.emailAddresses,emailDomains:()=>r.emailDomains,emailGroups:()=>r.emailGroups,endpointDeliveries:()=>r.endpointDeliveries,endpoints:()=>r.endpoints,parsedEmails:()=>r.parsedEmails,receivedEmails:()=>r.receivedEmails,sentEmails:()=>r.sentEmails,sesEvents:()=>r.sesEvents,session:()=>r.session,structuredEmails:()=>r.structuredEmails,subscriptions:()=>r.subscriptions,user:()=>r.user,userAccounts:()=>r.userAccounts,userOnboarding:()=>r.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>r.vipAllowedSenders,vipConfigs:()=>r.vipConfigs,vipEmailAttempts:()=>r.vipEmailAttempts,vipPaymentSessions:()=>r.vipPaymentSessions,webhookDeliveries:()=>r.webhookDeliveries,webhooks:()=>r.webhooks}),e.i(468686);var r=e.i(909834)},98050:function(e){var{g:s,__dirname:i,m:r,e:t}=e},930662:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({DELETE:()=>c,GET:()=>p,PUT:()=>u});var r=e.i(125427),t=e.i(402168),n=e.i(998322),o=e.i(557440);e.i(468686);var a=e.i(55379),d=e.i(176825),l=e.i(318812);async function p(e,{params:s}){try{console.log(`📋 GET /api/v1/endpoints/${s.id} - Fetching endpoint details`);let e=await t.auth.api.getSession({headers:await (0,n.headers)()});if(!e?.user?.id)return console.warn(`❌ GET /api/v1/endpoints/${s.id} - Unauthorized request`),r.NextResponse.json({error:"Unauthorized"},{status:401});let i=await o.db.select().from(a.endpoints).where((0,d.and)((0,d.eq)(a.endpoints.id,s.id),(0,d.eq)(a.endpoints.userId,e.user.id))).limit(1);if(!i[0])return r.NextResponse.json({error:"Endpoint not found or access denied"},{status:404});let l=[];"email_group"===i[0].type&&(l=(await o.db.select({emailAddress:a.emailGroups.emailAddress}).from(a.emailGroups).where((0,d.eq)(a.emailGroups.endpointId,s.id))).map(e=>e.emailAddress));let p=await o.db.select({status:a.endpointDeliveries.status,count:a.endpointDeliveries.id}).from(a.endpointDeliveries).where((0,d.eq)(a.endpointDeliveries.endpointId,s.id)),u=p.length,c=p.filter(e=>"success"===e.status).length,m=p.filter(e=>"failed"===e.status).length,E=u>0?Math.round(c/u*100):0,v={...i[0],groupEmails:l,deliveryStats:{total:u,successful:c,failed:m,successRate:E}};return console.log(`✅ GET /api/v1/endpoints/${s.id} - Retrieved endpoint details`),r.NextResponse.json({success:!0,endpoint:v})}catch(e){return console.error(`❌ GET /api/v1/endpoints/${s.id} - Error:`,e),r.NextResponse.json({success:!1,error:"Failed to fetch endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function u(e,{params:s}){try{console.log(`📝 PUT /api/v1/endpoints/${s.id} - Updating endpoint`);let i=await t.auth.api.getSession({headers:await (0,n.headers)()});if(!i?.user?.id)return console.warn(`❌ PUT /api/v1/endpoints/${s.id} - Unauthorized request`),r.NextResponse.json({error:"Unauthorized"},{status:401});let p=await e.json(),u=await o.db.select().from(a.endpoints).where((0,d.and)((0,d.eq)(a.endpoints.id,s.id),(0,d.eq)(a.endpoints.userId,i.user.id))).limit(1);if(!u[0])return r.NextResponse.json({error:"Endpoint not found or access denied"},{status:404});if(p.config){let e=function(e,s){try{switch(e){case"webhook":if(!s.url)return{valid:!1,error:"Webhook URL is required"};if("string"!=typeof s.url)return{valid:!1,error:"Webhook URL must be a string"};try{new URL(s.url)}catch{return{valid:!1,error:"Invalid webhook URL format"}}break;case"email":if(!s.forwardTo)return{valid:!1,error:"Forward-to email address is required"};if("string"!=typeof s.forwardTo)return{valid:!1,error:"Forward-to email must be a string"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.forwardTo))return{valid:!1,error:"Invalid forward-to email address format"};break;case"email_group":if(!s.emails||!Array.isArray(s.emails))return{valid:!1,error:"Email group must have an emails array"};if(0===s.emails.length)return{valid:!1,error:"Email group must have at least one email address"};let i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let e of s.emails)if("string"!=typeof e||!i.test(e))return{valid:!1,error:`Invalid email address in group: ${e}`};break;default:return{valid:!1,error:"Unknown endpoint type"}}return{valid:!0}}catch(e){return{valid:!1,error:"Configuration validation failed"}}}(u[0].type,p.config);if(!e.valid)return r.NextResponse.json({error:`Invalid configuration: ${e.error}`},{status:400})}let c={updatedAt:new Date};void 0!==p.name&&(c.name=p.name),void 0!==p.description&&(c.description=p.description),void 0!==p.isActive&&(c.isActive=p.isActive),void 0!==p.webhookFormat&&"webhook"===u[0].type&&(c.webhookFormat=p.webhookFormat),void 0!==p.config&&(c.config=JSON.stringify(p.config));let[m]=await o.db.update(a.endpoints).set(c).where((0,d.eq)(a.endpoints.id,s.id)).returning();if(p.config&&"email_group"===u[0].type&&"emails"in p.config){await o.db.delete(a.emailGroups).where((0,d.eq)(a.emailGroups.endpointId,s.id));let e=p.config.emails.map(e=>({id:(0,l.nanoid)(),endpointId:s.id,emailAddress:e,createdAt:new Date}));e.length>0&&(await o.db.insert(a.emailGroups).values(e),console.log(`📮 PUT /api/v1/endpoints/${s.id} - Updated ${e.length} email group entries`))}return console.log(`✅ PUT /api/v1/endpoints/${s.id} - Successfully updated endpoint`),r.NextResponse.json({success:!0,endpoint:m})}catch(e){return console.error(`❌ PUT /api/v1/endpoints/${s.id} - Error:`,e),r.NextResponse.json({success:!1,error:"Failed to update endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(e,{params:s}){try{console.log(`🗑️ DELETE /api/v1/endpoints/${s.id} - Deleting endpoint`);let e=await t.auth.api.getSession({headers:await (0,n.headers)()});if(!e?.user?.id)return console.warn(`❌ DELETE /api/v1/endpoints/${s.id} - Unauthorized request`),r.NextResponse.json({error:"Unauthorized"},{status:401});let i=await o.db.select().from(a.endpoints).where((0,d.and)((0,d.eq)(a.endpoints.id,s.id),(0,d.eq)(a.endpoints.userId,e.user.id))).limit(1);if(!i[0])return r.NextResponse.json({error:"Endpoint not found or access denied"},{status:404});let l=await o.db.update(a.emailAddresses).set({endpointId:null,updatedAt:new Date}).where((0,d.eq)(a.emailAddresses.endpointId,s.id)).returning({address:a.emailAddresses.address});return l.length>0&&console.log(`📧 DELETE /api/v1/endpoints/${s.id} - Updated ${l.length} email addresses to store-only mode:`,l.map(e=>e.address).join(", ")),await o.db.update(a.emailDomains).set({catchAllEndpointId:null,updatedAt:new Date}).where((0,d.eq)(a.emailDomains.catchAllEndpointId,s.id)),"email_group"===i[0].type&&(await o.db.delete(a.emailGroups).where((0,d.eq)(a.emailGroups.endpointId,s.id)),console.log(`📮 DELETE /api/v1/endpoints/${s.id} - Deleted email group entries`)),await o.db.delete(a.endpointDeliveries).where((0,d.eq)(a.endpointDeliveries.endpointId,s.id)),console.log(`📊 DELETE /api/v1/endpoints/${s.id} - Deleted delivery history`),await o.db.delete(a.endpoints).where((0,d.eq)(a.endpoints.id,s.id)),console.log(`✅ DELETE /api/v1/endpoints/${s.id} - Successfully deleted endpoint`),r.NextResponse.json({success:!0,message:l.length>0?`Endpoint deleted successfully. ${l.length} email address(es) switched to store-only mode.`:"Endpoint deleted successfully",emailAddressesUpdated:l.length})}catch(e){return console.error(`❌ DELETE /api/v1/endpoints/${s.id} - Error:`,e),r.NextResponse.json({success:!1,error:"Failed to delete endpoint",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}},117363:e=>{"use strict";var{g:s,__dirname:i}=e;{e.s({patchFetch:()=>a,routeModule:()=>s,serverHooks:()=>l,workAsyncStorage:()=>i,workUnitAsyncStorage:()=>d});var r=e.i(854885),t=e.i(814689),n=e.i(25402),o=e.i(930662);let s=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/v1/endpoints/[id]/route",pathname:"/api/v1/endpoints/[id]",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v1/endpoints/[id]/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:i,workUnitAsyncStorage:d,serverHooks:l}=s;function a(){return(0,n.patchFetch)({workAsyncStorage:i,workUnitAsyncStorage:d})}}},993477:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/[root-of-the-server]__88d28cf6._.js","server/chunks/node_modules_10ae7a2d._.js"].map(s=>e.l(s))).then(()=>s(611487)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__6889b8eb._.js.map