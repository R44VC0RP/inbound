module.exports={929549:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:r,__dirname:s,m:t,e:i}=e;t.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>i.DELIVERY_STATUS,DELIVERY_TYPES:()=>i.DELIVERY_TYPES,DOMAIN_STATUS:()=>i.DOMAIN_STATUS,EMAIL_STATUS:()=>i.EMAIL_STATUS,ENDPOINT_TYPES:()=>i.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>i.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>i.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>i.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>i.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>i.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>i.WEBHOOK_STATUS,account:()=>t.account,apikey:()=>t.apikey,blockedEmails:()=>i.blockedEmails,domainDnsRecords:()=>i.domainDnsRecords,emailAddresses:()=>i.emailAddresses,emailDomains:()=>i.emailDomains,emailGroups:()=>i.emailGroups,endpointDeliveries:()=>i.endpointDeliveries,endpoints:()=>i.endpoints,parsedEmails:()=>i.parsedEmails,receivedEmails:()=>i.receivedEmails,sentEmails:()=>i.sentEmails,sesEvents:()=>i.sesEvents,session:()=>t.session,structuredEmails:()=>i.structuredEmails,subscriptions:()=>i.subscriptions,user:()=>t.user,userAccounts:()=>i.userAccounts,userOnboarding:()=>i.userOnboarding,verification:()=>t.verification,vipAllowedSenders:()=>i.vipAllowedSenders,vipConfigs:()=>i.vipConfigs,vipEmailAttempts:()=>i.vipEmailAttempts,vipPaymentSessions:()=>i.vipPaymentSessions,webhookDeliveries:()=>i.webhookDeliveries,webhooks:()=>i.webhooks});var t=e.i(594120),i=e.i(55379)},436754:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>t.DELIVERY_STATUS,DELIVERY_TYPES:()=>t.DELIVERY_TYPES,DOMAIN_STATUS:()=>t.DOMAIN_STATUS,EMAIL_STATUS:()=>t.EMAIL_STATUS,ENDPOINT_TYPES:()=>t.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>t.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>t.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>t.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>t.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>t.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>t.WEBHOOK_STATUS,account:()=>t.account,apikey:()=>t.apikey,blockedEmails:()=>t.blockedEmails,domainDnsRecords:()=>t.domainDnsRecords,emailAddresses:()=>t.emailAddresses,emailDomains:()=>t.emailDomains,emailGroups:()=>t.emailGroups,endpointDeliveries:()=>t.endpointDeliveries,endpoints:()=>t.endpoints,parsedEmails:()=>t.parsedEmails,receivedEmails:()=>t.receivedEmails,sentEmails:()=>t.sentEmails,sesEvents:()=>t.sesEvents,session:()=>t.session,structuredEmails:()=>t.structuredEmails,subscriptions:()=>t.subscriptions,user:()=>t.user,userAccounts:()=>t.userAccounts,userOnboarding:()=>t.userOnboarding,verification:()=>t.verification,vipAllowedSenders:()=>t.vipAllowedSenders,vipConfigs:()=>t.vipConfigs,vipEmailAttempts:()=>t.vipEmailAttempts,vipPaymentSessions:()=>t.vipPaymentSessions,webhookDeliveries:()=>t.webhookDeliveries,webhooks:()=>t.webhooks}),e.i(468686);var t=e.i(909834)},153364:function(e){var{g:r,__dirname:s,m:t,e:i}=e;"use strict";t.exports=e.r(68043).vendored["react-rsc"].ReactServerDOMTurbopackServerEdge},497929:function(e){var{g:r,__dirname:s,m:t,e:i}=e},197739:e=>{"use strict";var{g:r,__dirname:s}=e;e.s({POST:()=>l});var t=e.i(125427),i=e.i(494642),a=e.i(557440);e.i(468686);var n=e.i(55379),o=e.i(176825),u=e.i(367027);function d(e){return e.replace(/[<>]/g,"").trim()}function c(e){return e?e.split(/\s+/).map(e=>d(e)).filter(e=>e.length>0):[]}async function l(e){try{let{userId:r,error:s}=await (0,i.validateRequest)(e);if(s)return t.NextResponse.json({success:!1,error:s},{status:401});let l=await e.json();if(!l.emailIds||!Array.isArray(l.emailIds))return t.NextResponse.json({success:!1,error:"emailIds array is required"},{status:400});let p=await a.db.select({id:n.structuredEmails.id,messageId:n.structuredEmails.messageId,inReplyTo:n.structuredEmails.inReplyTo,references:n.structuredEmails.references,headers:n.structuredEmails.headers,subject:n.structuredEmails.subject}).from(n.structuredEmails).where((0,o.and)((0,o.eq)(n.structuredEmails.userId,r),(0,o.inArray)(n.structuredEmails.id,l.emailIds))),m=[];for(let e of p)try{let s=function(e){let r=new Set;e.messageId&&r.add(d(e.messageId));try{let s=e.headers?JSON.parse(e.headers):{};s["In-Reply-To"]&&r.add(d(s["In-Reply-To"])),s.References&&c(s.References).forEach(e=>r.add(e))}catch(e){}if(e.inReplyTo&&r.add(d(e.inReplyTo)),e.references)try{c(e.references).forEach(e=>r.add(e))}catch(e){}return r}(e);if(0===s.size){m.push({emailId:e.id,threadCount:1,hasThread:!1});continue}let t=Array.from(s),[i]=await a.db.select({count:u.sql`count(*)`}).from(n.structuredEmails).where((0,o.and)((0,o.eq)(n.structuredEmails.userId,r),(0,o.or)((0,o.inArray)(n.structuredEmails.messageId,t),(0,o.inArray)(n.structuredEmails.inReplyTo,t),...t.map(e=>(0,o.like)(n.structuredEmails.references,`%${e}%`))))),[l]=await a.db.select({count:u.sql`count(*)`}).from(n.sentEmails).where((0,o.and)((0,o.eq)(n.sentEmails.userId,r),(0,o.or)(...t.map(e=>(0,o.like)(n.sentEmails.headers,`%${e}%`))))),p={count:0};if(e.subject){let s=e.subject.replace(/^(re|fwd?|fw):\s*/gi,"").trim();if(s.length>3){let[e]=await a.db.select({count:u.sql`count(*)`}).from(n.structuredEmails).where((0,o.and)((0,o.eq)(n.structuredEmails.userId,r),(0,o.like)(n.structuredEmails.subject,`%${s}%`)));p=e}}let E=(i?.count||0)+(l?.count||0),T=Math.max(E,p.count,1);m.push({emailId:e.id,threadCount:T,hasThread:T>1})}catch(r){console.error(`Error calculating thread count for email ${e.id}:`,r),m.push({emailId:e.id,threadCount:1,hasThread:!1})}let E=new Set(m.map(e=>e.emailId));for(let e of l.emailIds)E.has(e)||m.push({emailId:e,threadCount:1,hasThread:!1});return console.log(`ðŸ“§ Thread counts calculated for ${m.length} emails for user ${r}`),t.NextResponse.json({success:!0,data:m})}catch(e){return console.error("Thread counts API error:",e),t.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}},775468:e=>{"use strict";var{g:r,__dirname:s}=e;{e.s({patchFetch:()=>o,routeModule:()=>r,serverHooks:()=>d,workAsyncStorage:()=>s,workUnitAsyncStorage:()=>u});var t=e.i(854885),i=e.i(814689),a=e.i(25402),n=e.i(197739);let r=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/v2/mail/thread-counts/route",pathname:"/api/v2/mail/thread-counts",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v2/mail/thread-counts/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:s,workUnitAsyncStorage:u,serverHooks:d}=r;function o(){return(0,a.patchFetch)({workAsyncStorage:s,workUnitAsyncStorage:u})}}},993477:e=>{var{g:r,__dirname:s}=e;e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__a3d5bddf._.js","server/chunks/node_modules_10ae7a2d._.js"].map(r=>e.l(r))).then(()=>r(611487)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__2b462de9._.js.map