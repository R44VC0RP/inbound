module.exports={929549:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:s,__dirname:i,m:r,e:o}=e;r.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({DELIVERY_STATUS:()=>o.DELIVERY_STATUS,DELIVERY_TYPES:()=>o.DELIVERY_TYPES,DOMAIN_STATUS:()=>o.DOMAIN_STATUS,EMAIL_STATUS:()=>o.EMAIL_STATUS,ENDPOINT_TYPES:()=>o.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>o.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>o.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>o.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>o.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>o.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>o.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>o.blockedEmails,domainDnsRecords:()=>o.domainDnsRecords,emailAddresses:()=>o.emailAddresses,emailDomains:()=>o.emailDomains,emailGroups:()=>o.emailGroups,endpointDeliveries:()=>o.endpointDeliveries,endpoints:()=>o.endpoints,parsedEmails:()=>o.parsedEmails,receivedEmails:()=>o.receivedEmails,sentEmails:()=>o.sentEmails,sesEvents:()=>o.sesEvents,session:()=>r.session,structuredEmails:()=>o.structuredEmails,subscriptions:()=>o.subscriptions,user:()=>r.user,userAccounts:()=>o.userAccounts,userOnboarding:()=>o.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>o.vipAllowedSenders,vipConfigs:()=>o.vipConfigs,vipEmailAttempts:()=>o.vipEmailAttempts,vipPaymentSessions:()=>o.vipPaymentSessions,webhookDeliveries:()=>o.webhookDeliveries,webhooks:()=>o.webhooks});var r=e.i(594120),o=e.i(55379)},436754:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({DELIVERY_STATUS:()=>r.DELIVERY_STATUS,DELIVERY_TYPES:()=>r.DELIVERY_TYPES,DOMAIN_STATUS:()=>r.DOMAIN_STATUS,EMAIL_STATUS:()=>r.EMAIL_STATUS,ENDPOINT_TYPES:()=>r.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>r.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>r.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>r.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>r.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>r.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>r.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>r.blockedEmails,domainDnsRecords:()=>r.domainDnsRecords,emailAddresses:()=>r.emailAddresses,emailDomains:()=>r.emailDomains,emailGroups:()=>r.emailGroups,endpointDeliveries:()=>r.endpointDeliveries,endpoints:()=>r.endpoints,parsedEmails:()=>r.parsedEmails,receivedEmails:()=>r.receivedEmails,sentEmails:()=>r.sentEmails,sesEvents:()=>r.sesEvents,session:()=>r.session,structuredEmails:()=>r.structuredEmails,subscriptions:()=>r.subscriptions,user:()=>r.user,userAccounts:()=>r.userAccounts,userOnboarding:()=>r.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>r.vipAllowedSenders,vipConfigs:()=>r.vipConfigs,vipEmailAttempts:()=>r.vipEmailAttempts,vipPaymentSessions:()=>r.vipPaymentSessions,webhookDeliveries:()=>r.webhookDeliveries,webhooks:()=>r.webhooks}),e.i(468686);var r=e.i(909834)},153364:function(e){var{g:s,__dirname:i,m:r,e:o}=e;"use strict";r.exports=e.r(68043).vendored["react-rsc"].ReactServerDOMTurbopackServerEdge},452279:function(e){var{g:s,__dirname:i,m:r,e:o}=e},972089:e=>{"use strict";var{g:s,__dirname:i}=e;e.s({GET:()=>m,POST:()=>p});var r=e.i(125427),o=e.i(494642),t=e.i(557440);e.i(468686);var n=e.i(55379),a=e.i(176825),d=e.i(460009),l=e.i(91890),c=e.i(318812),u=e.i(807204);async function m(e){console.log("üìß GET /api/v2/email-addresses - Starting request");try{console.log("üîê Validating request authentication");let{userId:s,error:i}=await (0,o.validateRequest)(e);if(!s)return console.log("‚ùå Authentication failed:",i),r.NextResponse.json({error:i},{status:401});console.log("‚úÖ Authentication successful for userId:",s);let{searchParams:c}=new URL(e.url),u=Math.min(parseInt(c.get("limit")||"50"),100),m=parseInt(c.get("offset")||"0"),p=c.get("domainId"),v=c.get("isActive"),A=c.get("isReceiptRuleConfigured");if(console.log("üìä Query parameters:",{limit:u,offset:m,domainId:p,isActive:v,isReceiptRuleConfigured:A}),u<1||u>100)return console.log("‚ö†Ô∏è Invalid limit parameter:",u),r.NextResponse.json({error:"Limit must be between 1 and 100"},{status:400});if(m<0)return console.log("‚ö†Ô∏è Invalid offset parameter:",m),r.NextResponse.json({error:"Offset must be non-negative"},{status:400});let g=[(0,a.eq)(n.emailAddresses.userId,s)];if(p&&(g.push((0,a.eq)(n.emailAddresses.domainId,p)),console.log("üîç Filtering by domainId:",p)),null!==v){let e="true"===v;g.push((0,a.eq)(n.emailAddresses.isActive,e)),console.log("üîç Filtering by active status:",e)}if(null!==A){let e="true"===A;g.push((0,a.eq)(n.emailAddresses.isReceiptRuleConfigured,e)),console.log("üîç Filtering by receipt rule configured:",e)}let f=g.length>1?(0,a.and)(...g):g[0];console.log("üîç Querying email addresses from database");let E=await t.db.select({id:n.emailAddresses.id,address:n.emailAddresses.address,domainId:n.emailAddresses.domainId,webhookId:n.emailAddresses.webhookId,endpointId:n.emailAddresses.endpointId,isActive:n.emailAddresses.isActive,isReceiptRuleConfigured:n.emailAddresses.isReceiptRuleConfigured,receiptRuleName:n.emailAddresses.receiptRuleName,createdAt:n.emailAddresses.createdAt,updatedAt:n.emailAddresses.updatedAt,userId:n.emailAddresses.userId,domainName:n.emailDomains.domain,domainStatus:n.emailDomains.status}).from(n.emailAddresses).innerJoin(n.emailDomains,(0,a.eq)(n.emailAddresses.domainId,n.emailDomains.id)).where(f).orderBy((0,d.desc)(n.emailAddresses.createdAt)).limit(u).offset(m);console.log("üìä Retrieved email addresses count:",E.length);let S=await t.db.select({count:(0,l.count)()}).from(n.emailAddresses).where(f),I=S[0]?.count||0;console.log("üìä Total email addresses count:",I),console.log("üîß Enhancing email addresses with routing information");let _=[];for(let e of E){let s={type:"none",id:null,name:null,isActive:!1};if(e.endpointId){let i=await t.db.select({id:n.endpoints.id,name:n.endpoints.name,type:n.endpoints.type,config:n.endpoints.config,isActive:n.endpoints.isActive}).from(n.endpoints).where((0,a.eq)(n.endpoints.id,e.endpointId)).limit(1);i[0]&&(s={type:"endpoint",id:i[0].id,name:i[0].name,config:JSON.parse(i[0].config),isActive:i[0].isActive||!1})}else if(e.webhookId){let i=await t.db.select({id:n.webhooks.id,name:n.webhooks.name,url:n.webhooks.url,isActive:n.webhooks.isActive}).from(n.webhooks).where((0,a.eq)(n.webhooks.id,e.webhookId)).limit(1);i[0]&&(s={type:"webhook",id:i[0].id,name:i[0].name,config:{url:i[0].url},isActive:i[0].isActive||!1})}_.push({id:e.id,address:e.address,domainId:e.domainId,webhookId:e.webhookId,endpointId:e.endpointId,isActive:e.isActive||!1,isReceiptRuleConfigured:e.isReceiptRuleConfigured||!1,receiptRuleName:e.receiptRuleName,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt||new Date,userId:e.userId,domain:{id:e.domainId,name:e.domainName,status:e.domainStatus},routing:s})}return console.log("‚úÖ GET /api/v2/email-addresses - Successfully retrieved email addresses"),r.NextResponse.json({data:_,pagination:{limit:u,offset:m,total:I,hasMore:m+u<I}},{status:200})}catch(e){return console.error("‚ùå GET /api/v2/email-addresses - Error:",e),r.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){console.log("üìù POST /api/v2/email-addresses - Starting request");try{console.log("üîê Validating request authentication");let{userId:s,error:i}=await (0,o.validateRequest)(e);if(!s)return console.log("‚ùå Authentication failed:",i),r.NextResponse.json({error:i},{status:401});console.log("‚úÖ Authentication successful for userId:",s);let d=await e.json();if(console.log("üìã Request data:",{address:d.address,domainId:d.domainId,endpointId:d.endpointId,webhookId:d.webhookId,isActive:d.isActive}),!d.address||!d.domainId)return console.log("‚ùå Missing required fields"),r.NextResponse.json({error:"Missing required fields",required:["address","domainId"]},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.address))return console.log("‚ùå Invalid email address format:",d.address),r.NextResponse.json({error:"Invalid email address format"},{status:400});console.log("üîç Checking domain ownership");let l=await t.db.select().from(n.emailDomains).where((0,a.and)((0,a.eq)(n.emailDomains.id,d.domainId),(0,a.eq)(n.emailDomains.userId,s))).limit(1);if(!l[0])return console.log("‚ùå Domain not found or access denied:",d.domainId),r.NextResponse.json({error:"Domain not found or access denied"},{status:404});let m=d.address.split("@")[1];if(m!==l[0].domain)return console.log("‚ùå Email domain mismatch:",m,"vs",l[0].domain),r.NextResponse.json({error:`Email address must belong to domain ${l[0].domain}`},{status:400});if(console.log("üîç Checking if email address already exists"),(await t.db.select().from(n.emailAddresses).where((0,a.eq)(n.emailAddresses.address,d.address)).limit(1))[0])return console.log("‚ùå Email address already exists:",d.address),r.NextResponse.json({error:"Email address already exists"},{status:409});let p=null,v=null,A=null;if(d.endpointId){console.log("üîç Validating endpoint:",d.endpointId);let e=await t.db.select().from(n.endpoints).where((0,a.and)((0,a.eq)(n.endpoints.id,d.endpointId),(0,a.eq)(n.endpoints.userId,s))).limit(1);if(!e[0])return console.log("‚ùå Endpoint not found or access denied:",d.endpointId),r.NextResponse.json({error:"Endpoint not found or access denied"},{status:404});p=d.endpointId,A={type:"endpoint",id:e[0].id,name:e[0].name,config:JSON.parse(e[0].config),isActive:e[0].isActive||!1}}else if(d.webhookId){console.log("üîç Validating webhook:",d.webhookId);let e=await t.db.select().from(n.webhooks).where((0,a.and)((0,a.eq)(n.webhooks.id,d.webhookId),(0,a.eq)(n.webhooks.userId,s))).limit(1);if(!e[0])return console.log("‚ùå Webhook not found or access denied:",d.webhookId),r.NextResponse.json({error:"Webhook not found or access denied"},{status:404});v=d.webhookId,A={type:"webhook",id:e[0].id,name:e[0].name,config:{url:e[0].url},isActive:e[0].isActive||!1}}console.log("üìù Creating email address record");let g={id:(0,c.nanoid)(),address:d.address,domainId:d.domainId,endpointId:p,webhookId:v,isActive:void 0===d.isActive||d.isActive,isReceiptRuleConfigured:!1,receiptRuleName:null,userId:s,createdAt:new Date,updatedAt:new Date},[f]=await t.db.insert(n.emailAddresses).values(g).returning();console.log("‚úÖ Email address record created:",f.id);let E=!1,S=null,I=null;try{console.log("üîß Configuring AWS SES receipt rules");let e=new u.AWSSESReceiptRuleManager,s=process.env.AWS_REGION||"us-east-2",i=process.env.LAMBDA_FUNCTION_NAME||"email-processor",r=process.env.S3_BUCKET_NAME,o=process.env.AWS_ACCOUNT_ID;if(r&&o){let c=u.AWSSESReceiptRuleManager.getLambdaFunctionArn(i,o,s);console.log("üîß Configuring SES receipt rule for:",d.address);let m=await e.configureEmailReceiving({domain:l[0].domain,emailAddresses:[d.address],lambdaFunctionArn:c,s3BucketName:r});"created"===m.status||"updated"===m.status?(await t.db.update(n.emailAddresses).set({isReceiptRuleConfigured:!0,receiptRuleName:m.ruleName,updatedAt:new Date}).where((0,a.eq)(n.emailAddresses.id,f.id)),E=!0,S=m.ruleName,console.log("‚úÖ AWS SES configured successfully")):(I=`SES configuration failed: ${m.error}`,console.warn(`‚ö†Ô∏è ${I}`))}else I="AWS configuration incomplete. Missing S3_BUCKET_NAME or AWS_ACCOUNT_ID",console.warn(`‚ö†Ô∏è ${I}`)}catch(e){I=`SES configuration error: ${e instanceof Error?e.message:"Unknown error"}`,console.error("‚ùå AWS SES configuration failed:",e)}let _={id:f.id,address:f.address,domainId:f.domainId,webhookId:f.webhookId,endpointId:f.endpointId,isActive:f.isActive||!1,isReceiptRuleConfigured:E,receiptRuleName:S,createdAt:f.createdAt||new Date,updatedAt:f.updatedAt||new Date,userId:f.userId,domain:{id:l[0].id,name:l[0].domain,status:l[0].status},routing:A||{type:"none",id:null,name:null,isActive:!1},...I&&{warning:I}};return console.log("‚úÖ POST /api/v2/email-addresses - Successfully created email address"),r.NextResponse.json(_,{status:201})}catch(e){return console.error("‚ùå POST /api/v2/email-addresses - Error:",e),r.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}},619415:e=>{"use strict";var{g:s,__dirname:i}=e;{e.s({patchFetch:()=>a,routeModule:()=>s,serverHooks:()=>l,workAsyncStorage:()=>i,workUnitAsyncStorage:()=>d});var r=e.i(854885),o=e.i(814689),t=e.i(25402),n=e.i(972089);let s=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/v2/email-addresses/route",pathname:"/api/v2/email-addresses",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v2/email-addresses/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:i,workUnitAsyncStorage:d,serverHooks:l}=s;function a(){return(0,t.patchFetch)({workAsyncStorage:i,workUnitAsyncStorage:d})}}},993477:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/[root-of-the-server]__ac46f68b._.js","server/chunks/node_modules_10ae7a2d._.js"].map(s=>e.l(s))).then(()=>s(611487)))},73518:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/9f50b_@smithy_credential-provider-imds_dist-es_d5e4d7ca._.js"].map(s=>e.l(s))).then(()=>s(653223)))},855094:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/[externals]_fs_promises_1c68bc94._.js","server/chunks/9f50b_@aws-sdk_credential-provider-http_89f62eca._.js"].map(s=>e.l(s))).then(()=>s(515630)))},520835:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-web-identity_f6906064._.js"].map(s=>e.l(s))).then(()=>s(399432)))},404886:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-process_dist-es_f8837f08._.js"].map(s=>e.l(s))).then(()=>s(31086)))},800893:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/9f50b_f59739fe._.js"].map(s=>e.l(s))).then(()=>s(387894)))},683391:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-sso_3ff63dce._.js"].map(s=>e.l(s))).then(()=>s(695705)))},586469:e=>{var{g:s,__dirname:i}=e;e.v(s=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/87a6c_@smithy_credential-provider-imds_dist-es_ee44b021._.js"].map(s=>e.l(s))).then(()=>s(488366)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__d0a06692._.js.map