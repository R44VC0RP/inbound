(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{660838:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({toggleVipStatus:()=>r});var a=e.i(286714),r=(0,a.createServerReference)("60da52dde5a2616fa146bcde823ecad23fe1644322",a.callServer,void 0,a.findSourceMapURL,"toggleVipStatus")},777353:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({updateVipConfig:()=>r});var a=e.i(286714),r=(0,a.createServerReference)("600958c8c97bc2260e7a61a589de77ee3220ef2a36",a.callServer,void 0,a.findSourceMapURL,"updateVipConfig")},978099:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({updateAccountStripeKey:()=>r});var a=e.i(286714),r=(0,a.createServerReference)("401aa170a6c916d095059400d40e8925ec001c2a85",a.callServer,void 0,a.findSourceMapURL,"updateAccountStripeKey")},397240:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({default:()=>P});var a=e.i(731636),r=e.i(838653),i=e.i(921361),n=e.i(282955),d=e.i(210339),l=e.i(834953),c=e.i(330790),o=e.i(268628),m=e.i(913948),u=e.i(706650),x=e.i(937249),p=e.i(890206),h=e.i(660838),g=e.i(777353),j=e.i(978099),f=e.i(55496),b=e.i(602833),y=e.i(451081),N=e.i(806178),v=e.i(773930),w=e.i(561657),S=e.i(799544),C=e.i(186240);e.i(841537);var k=e.i(453964),I=e.i(876038),V=e.i(555366);function P({addresses:e,recentSessions:t,allowedCountMap:s,hasVipByok:P,accountStripeKey:T,emailAttempts:_}){let[B,A]=(0,r.useState)(null),[K,R]=(0,r.useState)({}),{attach:D}=(0,k.useAutumn)(),F=(0,V.useRouter)(),U=(0,V.useSearchParams)(),E=async(e,t)=>{A(e);try{let s=await (0,h.toggleVipStatus)(e,t);s.error?f.toast.error(s.error):f.toast.success(t?"VIP protection enabled":"VIP protection disabled")}catch(e){f.toast.error("Failed to update VIP status")}finally{A(null)}},H=async e=>{e.preventDefault();let t=new FormData(e.currentTarget),s=t.get("vipConfigId");A(s);try{let e=await (0,g.updateVipConfig)(s,{price:t.get("price"),expirationHours:t.get("expirationHours"),allowAfterPayment:"on"===t.get("allowAfterPayment"),customMessage:t.get("customMessage")});e.error?f.toast.error(e.error):f.toast.success("VIP configuration updated")}catch(e){f.toast.error("Failed to update VIP configuration")}finally{A(null)}},L=async e=>{e.preventDefault();let t=new FormData(e.currentTarget).get("accountStripeKey");A("account-stripe-key");try{let s=await (0,j.updateAccountStripeKey)(t);s.error?f.toast.error(s.error):(f.toast.success("Account Stripe key updated"),R(e=>({...e,"stripe-key-form":!1})),e.currentTarget.reset())}catch(e){f.toast.error("Failed to update account Stripe key")}finally{A(null)}},z=e=>{R(t=>({...t,[e]:!t[e]}))},$=async()=>{try{await D({productId:"inbound_vip",successUrl:`${window.location.origin}/vip?upgrade=true`,dialog:I.default})}catch(e){console.error("Error upgrading to VIP BYOK:",e),f.toast.error("Failed to start upgrade process")}};return(0,r.useEffect)(()=>{if("true"===U.get("upgrade")){f.toast.success("Successfully upgraded to VIP BYOK! You can now use your own Stripe key.");let e=new URL(window.location.href);e.searchParams.delete("upgrade"),F.replace(e.pathname+e.search)}},[U,F]),(0,a.jsx)("div",{className:"min-h-screen font-outfit",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-4",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground mb-1 tracking-tight",children:"VIP Email Management"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:"Require payment from new senders to reach your inbox"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[P&&T&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-2 bg-accent border border-border rounded-lg",children:[(0,a.jsx)(w.default,{width:"16",height:"16",className:"text-green-600 dark:text-green-400"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-foreground",children:"Stripe Key Loaded: "}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:[T.substring(0,5),"•••••"]})]}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>R(e=>({...e,"stripe-key-form":!e["stripe-key-form"]})),children:"Replace"}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive/80",onClick:async()=>{if(confirm("Are you sure you want to remove your Stripe key? Future VIP payments will be processed through Inbound's account.")){A("account-stripe-key");try{let e=await (0,j.updateAccountStripeKey)("");e.error?f.toast.error(e.error):f.toast.success("Stripe key removed. Using Inbound's account for VIP payments.")}catch(e){f.toast.error("Failed to remove Stripe key")}finally{A(null)}}},disabled:"account-stripe-key"===B,children:"Remove"})]}),!P&&(0,a.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:$,children:[(0,a.jsx)(p.default,{className:"h-3 w-3 mr-1.5 text-yellow-500"}),"Upgrade to VIP BYOK"]})]})]})}),P&&T&&K["stripe-key-form"]&&(0,a.jsxs)(i.Card,{className:"bg-card border-border rounded-xl mb-6",children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-lg font-semibold text-foreground tracking-tight",children:"Replace Stripe Key"}),(0,a.jsx)(i.CardDescription,{className:"text-sm text-muted-foreground",children:"Update your Stripe restricted key for VIP payments"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Label,{htmlFor:"accountStripeKey",className:"text-sm font-medium",children:"New Stripe Restricted Key"}),(0,a.jsx)(c.Input,{id:"accountStripeKey",name:"accountStripeKey",type:"password",placeholder:"rk_live_...",className:"mt-1"}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter your new Stripe restricted key"}),(0,a.jsx)(l.Button,{type:"button",variant:"ghost",size:"sm",className:"text-xs p-0 h-auto text-primary hover:text-primary/80",onClick:()=>window.open("https://dashboard.stripe.com/apikeys/create?name=Inbound%20VIP&permissions%5B%5D=rak_charge_write&permissions%5B%5D=rak_checkout_session_write&permissions%5B%5D=rak_payment_link_write","_blank"),children:"Create in Stripe →"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(l.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>R(e=>({...e,"stripe-key-form":!1})),children:"Cancel"}),(0,a.jsx)(l.Button,{type:"submit",size:"sm",disabled:"account-stripe-key"===B,children:"account-stripe-key"===B?"Saving...":"Update Key"})]})]})})]}),P&&!T&&(0,a.jsxs)(i.Card,{className:"bg-card border-border rounded-xl mb-6",children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-lg font-semibold text-foreground tracking-tight",children:"Account Settings"}),(0,a.jsx)(i.CardDescription,{className:"text-sm text-muted-foreground",children:"Configure your account-level VIP settings"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-muted border border-border rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(S.default,{width:"20",height:"20",className:"text-orange-600 dark:text-orange-400 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Using Inbound's Stripe Account"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"VIP payments are currently processed through Inbound's Stripe account. Add your own Stripe restricted key to collect payments directly."})]})]})}),(0,a.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Label,{htmlFor:"accountStripeKey",className:"text-sm font-medium",children:"Account Stripe Restricted Key (Optional)"}),(0,a.jsx)(c.Input,{id:"accountStripeKey",name:"accountStripeKey",type:"password",placeholder:"rk_live_...",className:"mt-1"}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use your own Stripe account to collect VIP payments directly"}),(0,a.jsx)(l.Button,{type:"button",variant:"ghost",size:"sm",className:"text-xs p-0 h-auto text-primary hover:text-primary/80",onClick:()=>window.open("https://dashboard.stripe.com/apikeys/create?name=Inbound%20VIP&permissions%5B%5D=rak_charge_write&permissions%5B%5D=rak_checkout_session_write&permissions%5B%5D=rak_payment_link_write","_blank"),children:"Create Restricted Key in Stripe →"})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(l.Button,{type:"submit",size:"sm",disabled:"account-stripe-key"===B,children:"account-stripe-key"===B?"Saving...":"Add Stripe Key"})})]})]})})]}),(0,a.jsx)("div",{className:"space-y-2 mb-6",children:0===e.length?(0,a.jsx)(i.Card,{className:"bg-card border-border rounded-xl",children:(0,a.jsx)(i.CardContent,{className:"p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(b.CustomInboundIcon,{Icon:p.default,size:48,backgroundColor:"#eab308",className:"mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"No email addresses configured. Add email addresses in the Domains section first."}),(0,a.jsx)(l.Button,{variant:"secondary",asChild:!0,children:(0,a.jsx)(C.default,{href:"/emails",children:"Go to Domains"})})]})})}):e.map(({emailAddress:e,domain:t,vipConfig:r})=>(0,a.jsx)(i.Card,{className:"bg-card border-border hover:bg-accent/5 transition-all duration-300 rounded-xl overflow-hidden group",children:(0,a.jsxs)(i.CardContent,{className:"p-0",children:[(0,a.jsx)("div",{className:"p-4 border-b border-border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(b.CustomInboundIcon,{Icon:y.default,size:36,backgroundColor:e.isVipEnabled?"#eab308":"#64748b"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-foreground tracking-tight",children:e.address}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-0.5",children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:t?.domain||"Unknown domain"}),e.isVipEnabled&&r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"•"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground font-medium",children:["$",(r.priceInCents/100).toFixed(2)," per email"]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"•"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground font-medium",children:[s[r.id]||0," allowed senders"]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.isVipEnabled&&r&&(0,a.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>z(r.id),className:"h-8 px-2",children:[(0,a.jsx)(v.default,{width:"14",height:"14",className:"mr-1"}),"Config",(0,a.jsx)(N.default,{width:"14",height:"14",className:`ml-1 transition-transform duration-200 ${K[r.id]?"rotate-180":""}`})]}),(0,a.jsx)(m.Switch,{checked:e.isVipEnabled||!1,disabled:B===e.id,onCheckedChange:t=>E(e.id,t)})]})]})}),e.isVipEnabled&&r&&(0,a.jsx)("div",{className:"bg-muted/50 overflow-hidden transition-all duration-300 ease-in-out",style:{maxHeight:K[r.id]?"400px":"0px",opacity:+!!K[r.id]},children:(0,a.jsxs)("form",{onSubmit:H,className:"p-4 space-y-4",children:[(0,a.jsx)("input",{type:"hidden",name:"vipConfigId",value:r.id}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Label,{htmlFor:`price-${r.id}`,className:"text-xs",children:"Price (USD)"}),(0,a.jsxs)("div",{className:"relative mt-1",children:[(0,a.jsx)("span",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:"$"}),(0,a.jsx)(c.Input,{id:`price-${r.id}`,name:"price",type:"number",step:"0.01",min:"0.01",defaultValue:(r.priceInCents/100).toFixed(2),className:"pl-7 h-8 text-sm"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Label,{htmlFor:`expiration-${r.id}`,className:"text-xs",children:"Link Expiration (hours)"}),(0,a.jsx)(c.Input,{id:`expiration-${r.id}`,name:"expirationHours",type:"number",min:"1",max:"168",defaultValue:r.paymentLinkExpirationHours||24,className:"h-8 text-sm mt-1"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m.Switch,{id:`allow-future-${r.id}`,name:"allowAfterPayment",defaultChecked:r.allowAfterPayment||!1}),(0,a.jsx)(o.Label,{htmlFor:`allow-future-${r.id}`,className:"text-sm",children:"Allow all future emails after payment"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Label,{htmlFor:`message-${r.id}`,className:"text-xs",children:"Custom Message (optional)"}),(0,a.jsx)(u.Textarea,{id:`message-${r.id}`,name:"customMessage",placeholder:"Add a custom message to the payment request email...",defaultValue:r.customMessage||"",rows:2,className:"text-sm mt-1"})]}),(0,a.jsx)("div",{className:"flex justify-end pt-2",children:(0,a.jsx)(l.Button,{type:"submit",size:"sm",disabled:B===r.id,children:B===r.id?"Saving...":"Save Changes"})})]})})]})},e.id))}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"VIP Email Log"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Track all emails that hit your VIP protection and their payment status"}),_.length>0?(0,a.jsx)(i.Card,{className:"bg-card border-border rounded-xl",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{className:"border-b border-border",children:[(0,a.jsx)(n.TableHead,{className:"text-xs",children:"Sender"}),(0,a.jsx)(n.TableHead,{className:"text-xs",children:"Recipient"}),(0,a.jsx)(n.TableHead,{className:"text-xs",children:"Subject"}),(0,a.jsx)(n.TableHead,{className:"text-xs",children:"Status"}),(0,a.jsx)(n.TableHead,{className:"text-xs",children:"Payment Status"}),(0,a.jsx)(n.TableHead,{className:"text-xs text-right",children:"Received"})]})}),(0,a.jsx)(n.TableBody,{children:_.map(({attempt:e,paymentSession:t})=>(0,a.jsxs)(n.TableRow,{className:"border-b border-border",children:[(0,a.jsx)(n.TableCell,{className:"text-sm py-3",children:(0,a.jsx)("div",{className:"max-w-[150px] truncate",children:e.senderEmail})}),(0,a.jsx)(n.TableCell,{className:"text-sm py-3",children:(0,a.jsx)("div",{className:"max-w-[150px] truncate",children:e.recipientEmail})}),(0,a.jsx)(n.TableCell,{className:"text-sm py-3",children:(0,a.jsx)("div",{className:"max-w-[200px] truncate",children:e.emailSubject||"No subject"})}),(0,a.jsx)(n.TableCell,{className:"py-3",children:(0,a.jsxs)(d.Badge,{variant:"allowed"===e.status?"secondary":"payment_required"===e.status?"outline":"secondary",className:"text-xs",children:["allowed"===e.status&&(0,a.jsx)(w.default,{width:"10",height:"10",className:"mr-1"}),"payment_required"===e.status&&(0,a.jsx)(S.default,{width:"10",height:"10",className:"mr-1"}),"allowed"===e.status?"Allowed":"payment_required"===e.status?"Payment Required":e.status]})}),(0,a.jsx)(n.TableCell,{className:"py-3",children:t?(0,a.jsxs)(d.Badge,{variant:"paid"===t.status?"secondary":"pending"===t.status?"outline":"expired"===t.status?"destructive":"secondary",className:"text-xs",children:["paid"===t.status&&(0,a.jsx)(w.default,{width:"10",height:"10",className:"mr-1"}),"pending"===t.status&&(0,a.jsx)(S.default,{width:"10",height:"10",className:"mr-1"}),t.status]}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"N/A"})}),(0,a.jsx)(n.TableCell,{className:"text-sm text-muted-foreground text-right py-3",children:(0,x.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]},e.id))})]})}):(0,a.jsx)(i.Card,{className:"bg-card border-border rounded-xl",children:(0,a.jsx)(i.CardContent,{className:"p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(b.CustomInboundIcon,{Icon:y.default,size:48,backgroundColor:"#64748b",className:"mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"No VIP email attempts yet. Once you enable VIP protection on your email addresses, all incoming emails will be logged here."})]})})})]})]})})}}}]);

//# sourceMappingURL=9375bc6164809a78.js.map