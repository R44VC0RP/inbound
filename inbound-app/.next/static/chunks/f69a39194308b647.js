(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{979245:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({Label:()=>n,Root:()=>o});var a=e.i(838653),r=e.i(286697),i=e.i(731636),n=(0,a.forwardRef)((e,t)=>(0,i.jsx)(r.Primitive.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var o=n},268628:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({Label:()=>s});var a=e.i(731636),r=e.i(838653),i=e.i(979245),n=e.i(24985),o=e.i(718331);let t=(0,n.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),s=(0,r.forwardRef)(({className:e,...s},r)=>(0,a.jsx)(i.Root,{ref:r,className:(0,o.cn)(t(),e),...s}));s.displayName=i.Root.displayName}},520860:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({computeRoute:()=>d,default:()=>f,inject:()=>u,pageview:()=>h,track:()=>m}),e.i(922271);var a=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function r(){return"undefined"!=typeof window}function i(){return"production"}function n(){return(r()?window.vam:i())||"production"}function o(){return"production"===n()}function l(){return"development"===n()}function d(e,t){if(!e||!t)return e;let s=e;try{let e=Object.entries(t);for(let[t,a]of e)if(!Array.isArray(a)){let e=c(a);e.test(s)&&(s=s.replace(e,`/[${t}]`))}for(let[t,a]of e)if(Array.isArray(a)){let e=c(a.join("/"));e.test(s)&&(s=s.replace(e,`/[...${t}]`))}return s}catch(t){return e}}function c(e){return RegExp(`/${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?=[/?#]|$)`)}function u(e={debug:!0}){var t;if(!r())return;!function(e="auto"){if("auto"===e){window.vam=i();return}window.vam=e}(e.mode),a(),e.beforeSend&&(null==(t=window.va)||t.call(window,"beforeSend",e.beforeSend));let s=e.scriptSrc?e.scriptSrc:l()?"https://va.vercel-scripts.com/v1/script.debug.js":e.basePath?`${e.basePath}/insights/script.js`:"/_vercel/insights/script.js";if(document.head.querySelector(`script[src*="${s}"]`))return;let n=document.createElement("script");n.src=s,n.defer=!0,n.dataset.sdkn="@vercel/analytics"+(e.framework?`/${e.framework}`:""),n.dataset.sdkv="1.5.0",e.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),e.endpoint?n.dataset.endpoint=e.endpoint:e.basePath&&(n.dataset.endpoint=`${e.basePath}/insights`),e.dsn&&(n.dataset.dsn=e.dsn),n.onerror=()=>{let e=l()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${s}. ${e}`)},l()&&!1===e.debug&&(n.dataset.debug="false"),document.head.appendChild(n)}function m(e,t,s){var a,i;if(!r()){let e="[Vercel Web Analytics] Please import `track` from `@vercel/analytics/server` when using this function in a server environment";if(o())console.warn(e);else throw Error(e);return}if(!t){null==(a=window.va)||a.call(window,"event",{name:e,options:s});return}try{let a=function(e,t){if(!e)return;let s=e,a=[];for(let[r,i]of Object.entries(e))"object"==typeof i&&null!==i&&(t.strip?s=function(e,{[e]:t,...s}){return s}(r,s):a.push(r));if(a.length>0&&!t.strip)throw Error(`The following properties are not valid: ${a.join(", ")}. Only strings, numbers, booleans, and null are allowed.`);return s}(t,{strip:o()});null==(i=window.va)||i.call(window,"event",{name:e,data:a,options:s})}catch(e){e instanceof Error&&l()&&console.error(e)}}function h({route:e,path:t}){var s;null==(s=window.va)||s.call(window,"pageview",{route:e,path:t})}var f={inject:u,track:m,computeRoute:d}},921361:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({Card:()=>t,CardContent:()=>l,CardDescription:()=>o,CardFooter:()=>d,CardHeader:()=>s,CardTitle:()=>n});var a=e.i(731636),r=e.i(838653),i=e.i(718331);let t=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...t}));t.displayName="Card";let s=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));s.displayName="CardHeader";let n=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("font-semibold leading-none tracking-tight",e),...t}));n.displayName="CardTitle";let o=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let l=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...t}));l.displayName="CardContent";let d=(0,r.forwardRef)(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t}));d.displayName="CardFooter"}},561657:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({default:()=>t});var a=e.i(731636);let t=function({fill:e="currentColor",secondaryfill:t,title:s="badge 13",...r}){return t=t||e,(0,a.jsxs)("svg",{height:"18",width:"18",...r,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("title",{children:s}),(0,a.jsx)("g",{fill:e,children:(0,a.jsx)("path",{d:"M9,1C4.589,1,1,4.589,1,9s3.589,8,8,8,8-3.589,8-8S13.411,1,9,1Zm3.843,5.708l-4.25,5.5c-.136,.176-.343,.283-.565,.291-.01,0-.019,0-.028,0-.212,0-.415-.09-.558-.248l-2.25-2.5c-.277-.308-.252-.782,.056-1.06,.309-.276,.781-.252,1.06,.056l1.648,1.832,3.701-4.789c.253-.328,.725-.388,1.052-.135,.328,.253,.388,.724,.135,1.052Z",fill:e})})]})}}},602833:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({CustomInboundIcon:()=>t,default:()=>s});var a=e.i(731636);let t=({size:e=64,backgroundColor:t="#A50A3E",Icon:s,text:r,iconScale:i=.5,iconColor:n="white",className:o=""})=>{let l=e*i,d=.3*e,c=.4*e;return(0,a.jsx)("div",{className:`inline-flex items-center justify-center ${o}`,style:{width:e,height:e,backgroundColor:t,borderRadius:d,background:`linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 100%), ${t}`,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:s?(0,a.jsx)(s,{width:l,height:l,style:{color:n,filter:"drop-shadow(0px 1px 2px rgba(0,0,0,0.1))"}}):r?(0,a.jsx)("span",{style:{fontSize:c,fontWeight:"bold",color:n,textTransform:"uppercase",letterSpacing:"0.5px",textShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:r.slice(0,2)}):null})},s=t}},231843:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({domainV2Keys:()=>t,useAddEmailAddressV2Mutation:()=>c,useDeleteDomainV2Mutation:()=>d,useDeleteEmailAddressV2Mutation:()=>u,useDomainDetailsV2Query:()=>o,useDomainVerificationCheckV2:()=>l,useDomainsListV2Query:()=>s,useUpdateDomainCatchAllV2Mutation:()=>h,useUpdateEmailEndpointV2Mutation:()=>m});var a=e.i(645643),r=e.i(659544),i=e.i(628662),n=e.i(520860);let t={all:["v2","domains"],list:e=>[...t.all,"list",e],detail:e=>[...t.all,e],verification:e=>[...t.all,e,"verification"],emailAddresses:e=>[...t.all,e,"email-addresses"]},s=e=>(0,a.useQuery)({queryKey:t.list(e),queryFn:async()=>{let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.offset&&t.set("offset",e.offset.toString()),e?.status&&t.set("status",e.status),e?.canReceive&&t.set("canReceive",e.canReceive),e?.check&&t.set("check",e.check);let s=await fetch(`/api/v2/domains?${t}`);if(!s.ok)throw Error((await s.json()).error||`HTTP error! status: ${s.status}`);return s.json()},staleTime:12e4,gcTime:3e5}),o=e=>(0,a.useQuery)({queryKey:t.detail(e),queryFn:async()=>{let t=await fetch(`/api/v2/domains/${e}`);if(!t.ok)throw Error((await t.json()).error||`HTTP error! status: ${t.status}`);return t.json()},enabled:!!e,staleTime:12e4,gcTime:6e5}),l=e=>{let s=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async()=>{let e=await fetch("/api/v2/domains?status=pending&check=true");if(!e.ok)throw Error((await e.json()).error||"Failed to check verification");return e.json()},onSuccess:()=>{s.invalidateQueries({queryKey:t.detail(e)})}})},d=()=>{let e=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let t=await fetch(`/api/v2/domains/${e}`,{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete domain");return t.json()},onMutate:async s=>{console.log("🗑️ Starting optimistic domain deletion for:",s),await e.cancelQueries({queryKey:t.all});let a=[],r=e.getQueriesData({queryKey:t.all});for(let[t,i]of(console.log("📊 Found",r.length,"cached domain queries to update"),r))if(i&&Array.isArray(i.data)&&"object"==typeof i.meta&&null!==i.meta){console.log("✅ Updating query with",i.data.length,"domains, totalCount:",i.meta.totalCount),a.push({queryKey:t,data:i});let r={...i,data:i.data.filter(e=>e.id!==s),meta:{...i.meta,totalCount:Math.max((i.meta?.totalCount||0)-1,0)}};e.setQueryData(t,r),console.log("✅ Updated query - new count:",r.data.length,"totalCount:",r.meta.totalCount)}else console.warn("⚠️ Skipping invalid query data:",{hasData:!!i,isDataArray:!!i&&Array.isArray(i.data),hasMeta:!!i&&"object"==typeof i.meta&&null!==i.meta});return console.log("✅ Optimistic update complete - updated",a.length,"queries"),{previousQueriesData:a}},onError:(t,s,a)=>{if(console.error("❌ Domain deletion failed, rolling back optimistic updates:",t.message),a?.previousQueriesData){for(let{queryKey:t,data:s}of(console.log("🔄 Rolling back",a.previousQueriesData.length,"queries"),a.previousQueriesData))e.setQueryData(t,s);console.log("✅ Rollback complete")}},onSuccess:(s,a)=>{e.removeQueries({queryKey:t.detail(a)}),e.invalidateQueries({queryKey:t.all}),e.invalidateQueries({queryKey:["domains"]}),e.invalidateQueries({queryKey:["domainStats"]})}})},c=()=>{let e=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let t=await fetch("/api/v2/email-addresses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to add email address");return t.json()},onSuccess:s=>{(0,n.track)("Email Address Added",{address:s.address,domainId:s.domainId,emailAddressId:s.id}),e.invalidateQueries({queryKey:t.detail(s.domainId)}),e.invalidateQueries({queryKey:t.emailAddresses(s.domainId)})}})},u=()=>{let e=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async({emailAddressId:e})=>{let t=await fetch(`/api/v2/email-addresses/${e}`,{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete email address");return t.json()},onSuccess:(s,{domainId:a})=>{e.invalidateQueries({queryKey:t.detail(a)}),e.invalidateQueries({queryKey:t.emailAddresses(a)})}})},m=()=>{let e=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async({emailAddressId:e,domainId:t,...s})=>{console.log("🚀 Sending update request:",{url:`/api/v2/email-addresses/${e}`,body:s});let a=await fetch(`/api/v2/email-addresses/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw Error((await a.json()).error||"Failed to update endpoint");let r=await a.json();return console.log("📥 Update response:",r),r},onSuccess:(s,{domainId:a})=>{e.invalidateQueries({queryKey:t.detail(a)}),e.invalidateQueries({queryKey:t.emailAddresses(a)})}})},h=()=>{let e=(0,i.useQueryClient)();return(0,r.useMutation)({mutationFn:async({domainId:e,...t})=>{let s=await fetch(`/api/v2/domains/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error((await s.json()).error||"Failed to update catch-all settings");return s.json()},onSuccess:(s,{domainId:a,isCatchAllEnabled:r,catchAllEndpointId:i})=>{(0,n.track)(r?"Catch All Enabled":"Catch All Disabled",{domainId:a,endpointId:i||null}),e.invalidateQueries({queryKey:t.detail(a)})}})}}},936679:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({default:()=>t});var a=e.i(731636);let t=function({fill:e="currentColor",secondaryfill:t,title:s="badge 13",...r}){return t=t||e,(0,a.jsxs)("svg",{height:"12",width:"12",...r,viewBox:"0 0 12 12",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("title",{children:s}),(0,a.jsx)("g",{fill:e,children:(0,a.jsx)("path",{d:"m10.428,2.867l-2.295-2.294c-.363-.364-.867-.573-1.382-.573h-3.001C2.233,0,1,1.233,1,2.75v6.5c0,1.517,1.233,2.75,2.75,2.75h4.5c1.517,0,2.75-1.233,2.75-2.75v-5.001c0-.521-.203-1.012-.572-1.382Zm-3.355-1.233l2.294,2.293c.021.021.032.049.049.073h-2.415V1.585c.024.016.051.027.071.048,0,0,0,0,0,0Z",fill:e,strokeWidth:"0"})})]})}}},862421:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({default:()=>t});var a=e.i(731636);let t=function({fill:e="currentColor",secondaryfill:t,title:s="badge 13",...r}){return t=t||e,(0,a.jsxs)("svg",{height:"18",width:"18",...r,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("title",{children:s}),(0,a.jsx)("g",{fill:e,children:(0,a.jsx)("path",{d:"M15.25,6h-5.25v-1.993c0-.478-.266-.907-.694-1.12-.427-.212-.93-.165-1.311,.124L1.414,8.004c-.314,.238-.494,.601-.494,.996s.18,.757,.494,.996l6.581,4.993c.223,.169,.487,.255,.754,.255,.188,0,.38-.043,.557-.131,.429-.213,.694-.642,.694-1.12v-1.993h5.25c.965,0,1.75-.785,1.75-1.75v-2.5c0-.965-.785-1.75-1.75-1.75Z",fill:e})})]})}}},684812:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({default:()=>t});var a=e.i(731636);let t=function({fill:e="currentColor",secondaryfill:t,title:s="badge 13",...r}){return t=t||e,(0,a.jsxs)("svg",{height:"18",width:"18",...r,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("title",{children:s}),(0,a.jsxs)("g",{fill:e,children:[(0,a.jsx)("path",{d:"M13.75,2.5h-1.5c-.414,0-.75,.336-.75,.75s.336,.75,.75,.75h1.5c.689,0,1.25,.561,1.25,1.25v7.5c0,.689-.561,1.25-1.25,1.25H4.25c-.689,0-1.25-.561-1.25-1.25V5.25c0-.689,.561-1.25,1.25-1.25h1.5c.414,0,.75-.336,.75-.75s-.336-.75-.75-.75h-1.5c-1.517,0-2.75,1.233-2.75,2.75v7.5c0,1.517,1.233,2.75,2.75,2.75H13.75c1.517,0,2.75-1.233,2.75-2.75V5.25c0-1.517-1.233-2.75-2.75-2.75Z",fill:e}),(0,a.jsx)("path",{d:"M5.47,8.22c-.293,.293-.293,.768,0,1.061l3,3c.146,.146,.338,.22,.53,.22s.384-.073,.53-.22l3-3c.293-.293,.293-.768,0-1.061s-.768-.293-1.061,0l-1.72,1.72V3.25c0-.414-.336-.75-.75-.75s-.75,.336-.75,.75v6.689l-1.72-1.72c-.293-.293-.768-.293-1.061,0Z",fill:t})]})]})}}},509910:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({downloadAttachment:()=>r});var a=e.i(286714),r=(0,a.createServerReference)("6021894a83b2e73334806bae731dbe3ae3e2d52354",a.callServer,void 0,a.findSourceMapURL,"downloadAttachment")},563268:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({EmailAttachments:()=>c});var a=e.i(731636),r=e.i(834953),i=e.i(936679),n=e.i(684812),o=e.i(509910),l=e.i(602833);async function d(e,t){try{let s=await (0,o.downloadAttachment)(e,t);if(!s.success||!s.data){console.error("Failed to download attachment:",s.error),s.error?.includes("content not available")?alert("This attachment cannot be downloaded because the email was processed without full binary data storage. This typically happens with older emails or emails processed during system maintenance."):alert(`Failed to download attachment: ${s.error}`);return}let a=atob(s.data.content),r=new Uint8Array(a.length);for(let e=0;e<a.length;e++)r[e]=a.charCodeAt(e);let i=new Blob([r],{type:s.data.contentType}),n=URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.download=s.data.filename,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}catch(e){console.error("Error downloading attachment:",e),alert("An unexpected error occurred while downloading the attachment.")}}function c({emailId:e,attachments:t}){if(!t||0===t.length)return null;let s=t.filter(e=>e.filename);return 0===s.length?null:(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:[s.length," Attachment",s.length>1?"s":""]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:s.map((t,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(l.CustomInboundIcon,{Icon:i.default,backgroundColor:"#6b7280",size:32,className:"flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-gray-900 truncate",children:t.filename}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[t.contentType||"Unknown type"," • ",function(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}(t.size||0)]})]}),(0,a.jsx)(r.Button,{variant:"ghost",size:"sm",className:"text-gray-600 hover:bg-gray-100",onClick:()=>d(e,t.filename),disabled:!t.filename,children:(0,a.jsx)(n.default,{className:"h-4 w-4"})})]},s))})]})}},955544:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({extractNewContent:()=>n,getQuoteLevels:()=>l,hasQuotedContent:()=>o,parseEmailContent:()=>i,parseHtmlEmailContent:()=>r,parseTextEmailContent:()=>a,splitIntoMessages:()=>d});let t=[/^On .+, .+ wrote:$/m,/^Am .+ schrieb .+:$/m,/^Le .+ .+ a écrit :$/m,/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}.*wrote:/m,/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}.*wrote:/m,/^From: .+$/m,/^To: .+$/m,/^Subject: .+$/m,/^Date: .+$/m,/^----- ?Original Message ?-----/m,/^----- ?Forwarded [Mm]essage ?-----/m,/^Begin forwarded message:/m,/^---------- Forwarded message ----------/m,/^> /m,/^>\s*$/m,/^-----+/m,/^_{3,}/m,/^={3,}/m,/^Sent from my /m,/^Get Outlook for /m],s=[/On .+, .+ wrote:/,/Am .+ schrieb .+:/,/Le .+ .+ a écrit :/,/\d{4}-\d{2}-\d{2} \d{2}:\d{2}.*wrote:/,/\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}.*wrote:/,/----- ?Original Message ?-----/,/----- ?Forwarded [Mm]essage ?-----/,/Begin forwarded message:/,/---------- Forwarded message ----------/];function a(e){if(!e||"string"!=typeof e)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let a=e.split("\n"),r=[],i=[],n=!1,o=0;for(let e=0;e<a.length;e++){let l=a[e],d=l.trim();if(n)i.push(l),l.startsWith(">")&&(o=Math.max(o,l.match(/^>+/)?.[0]?.length||0));else{let c=s.some(e=>e.test(l)),u=l.startsWith(">")||""===d&&a[e+1]?.startsWith(">"),m=t.some(e=>e.test(l));c||u||m?(n=!0,i.push(l),l.startsWith(">")&&(o=Math.max(o,l.match(/^>+/)?.[0]?.length||0))):r.push(l)}}for(;r.length>0&&""===r[r.length-1].trim();)r.pop();let l=r.join("\n").trim(),d=i.join("\n").trim();return{newContent:l,quotedContent:d,hasQuotedContent:d.length>0,quoteLevels:o}}function r(e){if(!e||"string"!=typeof e)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let t=-1,s=0;for(let a of[/<div[^>]*class="[^"]*gmail_quote[^"]*"[^>]*>/i,/<blockquote[^>]*class="[^"]*gmail_quote[^"]*"[^>]*>/i,/<blockquote[^>]*>/i,/<div[^>]*style="[^"]*border-left[^"]*"[^>]*>/i,/<div[^>]*style="[^"]*margin-left[^"]*"[^>]*>/i,/<div[^>]*style="[^"]*border-top[^"]*"[^>]*>/i,/<div[^>]*class="[^"]*quote[^"]*"[^>]*>/i,/<div[^>]*class="[^"]*moz-cite-prefix[^"]*"[^>]*>/i]){let r=e.match(a);r&&void 0!==r.index&&(-1===t||r.index<t)&&(t=r.index,s=1)}for(let a of[/On .+, .+ wrote:/,/From: .+/,/----- ?Original Message ?-----/,/----- ?Forwarded [Mm]essage ?-----/,/Begin forwarded message:/,/---------- Forwarded message ----------/,/Sent from my /,/Get Outlook for /]){let r=e.match(a);r&&void 0!==r.index&&(-1===t||r.index<t)&&(t=r.index,s=1)}if(-1!==t){let a=e.substring(t).match(/<blockquote[^>]*>/gi);a&&(s=Math.max(s,a.length))}if(-1!==t){let a=e.substring(0,t).trim(),r=e.substring(t).trim();return{newContent:a,quotedContent:r,hasQuotedContent:r.length>0,quoteLevels:s}}return{newContent:e.trim(),quotedContent:"",hasQuotedContent:!1,quoteLevels:0}}function i(e){if(!e)return{newContent:"",quotedContent:"",hasQuotedContent:!1,quoteLevels:0};let t=/<[^>]+>/g.test(e),s=/&[a-zA-Z0-9#]+;/g.test(e);return t||s?r(e):a(e)}function n(e){return i(e).newContent}function o(e){return i(e).hasQuotedContent}function l(e){return i(e).quoteLevels}function d(e){let t;if(!e)return[];let a=[],r=e.split("\n"),i=[];for(let e=0;e<r.length;e++){let n=r[e],o=s.some(e=>e.test(n));o&&i.length>0?(a.push({content:i.join("\n").trim(),attribution:t,isForwarded:/forward|fwd/i.test(t||"")}),i=[],t=n.trim()):o?t=n.trim():i.push(n)}return i.length>0&&a.push({content:i.join("\n").trim(),attribution:t,isForwarded:/forward|fwd/i.test(t||"")}),a.filter(e=>e.content.length>0)}}},255099:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({default:()=>A});var a=e.i(731636),r=e.i(555366),i=e.i(395372),n=e.i(838653),o=e.i(921361),l=e.i(210339),d=e.i(834953),c=e.i(706650),u=e.i(268628),m=e.i(186240),h=e.i(862421),f=e.i(451081),x=e.i(561657),g=e.i(992460),p=e.i(13083),v=e.i(602833),y=e.i(563268);e.i(866971);var w=e.i(875960),j=e.i(231843),b=e.i(55496),N=e.i(955544);function C({message:e,isLatest:t=!1,showAttachments:s=!0}){let r=e.fromName||e.from.split("<")[0].trim()||e.from.split("@")[0],i=(e=>{let t=e.trim().split(/\s+/);return t.length>=2?(t[0].charAt(0)+t[1].charAt(0)).toUpperCase():e.slice(0,2).toUpperCase()})(r),n=(e=>{let t=["#6366f1","#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#ec4899","#84cc16"];return t[Math.abs(e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0))%t.length]})(r),o=e.receivedAt||e.sentAt,d=e.content.htmlBody?(0,N.extractNewContent)(e.content.htmlBody)||e.content.htmlBody:(0,N.extractNewContent)(e.content.textBody||"")||e.content.textBody;return(0,a.jsxs)("div",{className:`border-l-2 pl-4 pb-6 ${"outbound"===e.type?"border-l-blue-200 bg-blue-50/30":"border-l-gray-200"}`,children:[(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,a.jsx)(v.CustomInboundIcon,{text:i,size:32,backgroundColor:n}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-foreground text-sm",children:r}),(0,a.jsxs)("span",{className:"text-muted-foreground text-xs",children:["<",e.addresses.from?.addresses?.[0]?.address||e.from,">"]}),"outbound"===e.type&&(0,a.jsx)(l.Badge,{className:"bg-blue-500 text-white rounded-full px-2 py-0.5 text-xs",children:"Sent"})]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:o?(0,p.format)(new Date(o),"MMM d, h:mm a"):"Unknown date"})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["to ",e.to]})]})]}),(0,a.jsxs)("div",{className:"ml-8",children:[d?e.content.htmlBody?(0,a.jsx)("div",{className:"prose prose-sm max-w-none rounded-lg",style:{fontFamily:"Inter, system-ui, sans-serif",textAlign:"left"},dangerouslySetInnerHTML:{__html:d}}):(0,a.jsx)("div",{className:"whitespace-pre-wrap text-foreground leading-relaxed text-sm",style:{fontFamily:"Inter, system-ui, sans-serif",textAlign:"left"},children:d}):(0,a.jsxs)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:[(0,a.jsx)(f.default,{className:"h-4 w-4 mx-auto mb-1"}),(0,a.jsx)("p",{children:"No content available"})]}),s&&e.content.attachments&&e.content.attachments.length>0&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(y.EmailAttachments,{emailId:e.id,attachments:e.content.attachments})})]})]})}function A(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),{data:s}=(0,i.useSession)(),p=e.id,[v,y]=(0,n.useState)(""),[N,A]=(0,n.useState)(""),[k,M]=(0,n.useState)(!1),[S,q]=(0,n.useState)(""),{data:E,isLoading:T,error:F,refetch:Q}=(0,w.useEmailThreadV2Query)(p),$=(0,w.useMarkEmailAsReadV2Mutation)(),R=(0,w.useReplyToEmailV2Mutation)(),{data:D}=(0,j.useDomainsListV2Query)({status:"verified"});(0,n.useEffect)(()=>{s||t.push("/login")},[s,t]),(0,n.useEffect)(()=>{if(E?.messages){let e=E.messages.find(e=>e.id===p);e&&!e.isRead&&"inbound"===e.type&&$.mutate(p)}},[E,p,$]),(0,n.useEffect)(()=>{if(E?.messages&&!N&&!k){let e=E.messages.filter(e=>"inbound"===e.type).sort((e,t)=>new Date(t.receivedAt||0).getTime()-new Date(e.receivedAt||0).getTime())[0];e&&A(e.addresses.to?.addresses?.[0]?.address||e.to)}},[E,N,k]);let B=()=>{if(!S||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(S))return!1;let e=S.split("@")[1];return(D?.data?.filter(e=>"verified"===e.status)||[]).some(t=>t.domain===e)},L=async()=>{if(!v.trim())return void b.toast.error("Please enter a reply message");let e=k&&S?S:N;if(!e)return void b.toast.error("Please select a from address");if(k&&!B())return void b.toast.error("Invalid email address or domain not verified");let t=E?.messages?.filter(e=>"inbound"===e.type)?.sort((e,t)=>new Date(t.receivedAt||0).getTime()-new Date(e.receivedAt||0).getTime())[0],s=t?.addresses.from?.addresses?.[0]?.address||(t?.from.includes("<")?t.from.split("<")[1].replace(">",""):t?.from);try{await R.mutateAsync({emailId:p,from:e,to:s,text:v,include_original:!0}),b.toast.success("Reply sent successfully!"),y(""),q(""),M(!1),Q()}catch(e){console.error("Failed to send reply:",e),b.toast.error(e instanceof Error?e.message:"Failed to send reply")}};if(T)return(0,a.jsx)("div",{className:"p-4 font-outfit",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading conversation..."})})})});if(F||!E)return(0,a.jsx)("div",{className:"p-4 font-outfit",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,a.jsx)(m.default,{href:"/mail",children:(0,a.jsxs)(d.Button,{variant:"primary",children:[(0,a.jsx)(h.default,{className:"h-4 w-4 mr-2"}),"Back to Mail"]})})}),(0,a.jsx)(o.Card,{className:"border-destructive/50 bg-destructive/10 rounded-xl",children:(0,a.jsx)(o.CardContent,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,a.jsx)(f.default,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:F?.message||"Failed to load conversation"})]})})})]})});let P=E.messages[0]?.subject||"No Subject",O=E.messages.length;return(0,a.jsx)("div",{className:"p-4 font-outfit",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,a.jsx)(m.default,{href:"/mail",children:(0,a.jsxs)(d.Button,{variant:"primary",children:[(0,a.jsx)(h.default,{className:"h-4 w-4 mr-2"}),"Back to Mail"]})})}),(0,a.jsx)(o.Card,{className:"rounded-xl overflow-hidden mb-4",children:(0,a.jsx)(o.CardContent,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-foreground mb-2 tracking-tight",children:P}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[O," message",1!==O?"s":""," in conversation"]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(l.Badge,{className:"bg-blue-500 text-white rounded-full px-2.5 py-0.5 text-xs font-medium",children:[(0,a.jsx)(f.default,{className:"w-3 h-3 mr-1"}),"Thread"]})})]})})}),(0,a.jsx)(o.Card,{className:"rounded-xl overflow-hidden",children:(0,a.jsx)(o.CardContent,{className:"p-6",children:(0,a.jsx)("div",{className:"space-y-0",children:E.messages.map((e,t)=>(0,a.jsx)(C,{message:e,isLatest:t===E.messages.length-1,showAttachments:t===E.messages.length-1},e.id))})})}),(0,a.jsx)(o.Card,{className:"rounded-xl overflow-hidden mt-4",children:(0,a.jsx)(o.CardContent,{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Reply"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["From: ",k&&S?S:N]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.Textarea,{value:v,onChange:e=>y(e.target.value),placeholder:"Type your reply here...",rows:6,className:"w-full resize-none pr-16",disabled:R.isPending}),(0,a.jsx)(d.Button,{onClick:L,disabled:R.isPending||!v.trim()||!k&&!N||k&&(!S||!B()),size:"icon",className:"absolute bottom-2 right-2",title:"Send Reply",children:R.isPending?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,a.jsx)(g.default,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"pt-2 border-t border-border",children:(0,a.jsxs)(d.Button,{variant:"ghost",size:"sm",onClick:()=>M(!k),className:"text-xs text-muted-foreground hover:text-foreground",children:[k?"Hide":"Show"," Advanced Options"]})}),k&&(0,a.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.Label,{htmlFor:"custom-from",children:"Custom From Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"email",id:"custom-from",value:S,onChange:e=>q(e.target.value),placeholder:"custom@yourdomain.com",className:"flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"}),(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8",children:S&&(B()?(0,a.jsx)(x.default,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)("span",{className:"text-red-500",children:"❌"}))})]}),S&&!B()&&(0,a.jsxs)("p",{className:"text-xs text-red-500",children:["Email address must use one of your verified domains: ",D?.data?.filter(e=>"verified"===e.status).map(e=>e.domain).join(", ")]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.Label,{className:"text-xs text-muted-foreground",children:"Your Verified Domains"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:D?.data?.filter(e=>"verified"===e.status).map(e=>(0,a.jsxs)(l.Badge,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80",onClick:()=>{let t=S.split("@")[0]||"noreply";q(`${t}@${e.domain}`)},children:["@",e.domain]},e.id))})]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your reply will be added to this conversation thread."})]})})})]})})}}}]);

//# sourceMappingURL=a49273eb9c48e1a2.js.map